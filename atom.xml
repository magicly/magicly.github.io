<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>JustForFun</title>
  <subtitle>å·¥ç¨‹å¸ˆï¼Œç¨‹åºçŒ¿ï¼ŒMagicï¼Œå¾·å·æ‰‘å…‹</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://magicly.me/"/>
  <updated>2017-03-02T15:58:59.000Z</updated>
  <id>http://magicly.me/</id>
  
  <author>
    <name>magicly</name>
    <email>magicly007@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åœ¨markdowné‡Œå¦‚ä½•å†™æ•°å­¦å…¬å¼</title>
    <link href="http://magicly.me/2017/03/02/markdown-math/"/>
    <id>http://magicly.me/2017/03/02/markdown-math/</id>
    <published>2017-03-02T03:16:16.000Z</published>
    <updated>2017-03-02T15:58:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‡†å¤‡å†™ä¸€ä¸‹æœºå™¨å­¦ä¹ çš„ä¸€äº›å­¦ä¹ ç¬”è®°ï¼Œ ç”±äºæ¶‰åŠåˆ°å¤§é‡æ•°å­¦å…¬å¼ï¼Œ å‘ç°ä¸æŠŠå¦‚ä½•åœ¨markdowné‡Œå†™æ•°å­¦å…¬å¼è¿™ä¸ªé—®é¢˜è§£å†³äº†ä¼šä¸¥é‡å½±å“å·¥ä½œæ•ˆç‡ã€‚å¤§æ¦‚è€Œè¨€ï¼Œ ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<a id="more"></a>
<ol>
<li>ç”¨å›¾ç‰‡ï¼<br>ä¹Ÿå°±æ˜¯ç¼–è¾‘å¥½å…¬å¼ï¼Œä¸Šä¼ ï¼Œç„¶ååœ¨markdowné‡Œé¢å¼•ç”¨å›¾ç‰‡é“¾æ¥çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼æ–¹ä¾¿ç›´æ¥ï¼Œä½†æ˜¯æ˜¾å¾—æ¯”è¾ƒlowä¸€ç‚¹ã€‚ æœ‰å…´è¶£çš„å¯ä»¥å‚è€ƒè¿™å‡ ç¯‡æ–‡ç« ã€‚</li>
</ol>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2011/07/formula_online_generator.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2011/07/formula_online_generator.html</a><br>å½“ç„¶ï¼Œ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ å¿…é¡»ä½¿ç”¨è¿™ç§æ€è·¯ã€‚ æ¯”å¦‚ï¼Œ å¾®ä¿¡å…¬ä¼—å·é‡Œã€‚ å¯ä»¥å‚è€ƒ<a href="http://www.52nlp.cn/%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E9%87%8C%E4%BD%BF%E7%94%A8latex%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F" target="_blank" rel="external">è¿™é‡Œ</a></li>
</ul>
<ol>
<li>ç”¨Mathjaxæ’ä»¶æ¥å†™LaTexå…¬å¼ã€‚<br>å“ªæ€•ä½ æ˜¯ç”¨å›¾ç‰‡ï¼Œ é‚£ä¹Ÿå¾—å†™å‡ºLaTexå…¬å¼å•Šã€‚æ‰€ä»¥æˆ‘ä»¬ä»Šå¤©ä¸»è¦è®²ç¬¬äºŒç§æ–¹å¼ã€‚æ¨è<a href="https://webdemo.myscript.com/views/math.html" target="_blank" rel="external">è¿™ä¸ªå·¥å…·</a>ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨é‡Œæ‰‹å†™å…¬å¼ï¼Œå®ƒä¼šå¸®ä½ è½¬ä¸ºLaTexï¼å¾ˆå¥½å¾ˆå¼ºå¤§ã€‚</li>
</ol>
<h1 id="MathJaxæ’ä»¶"><a href="#MathJaxæ’ä»¶" class="headerlink" title="MathJaxæ’ä»¶"></a>MathJaxæ’ä»¶</h1><p>è‘—åçš„Stackoverflowç½‘ç«™ä¸Šçš„æ¼‚äº®å…¬å¼ï¼Œå°±æ˜¯ä½¿ç”¨äº†MathJaxæ’ä»¶çš„æ•ˆæœã€‚æ·»åŠ MathJaxæ’ä»¶ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨markdownæ–‡ä»¶ä¸­ï¼Œæ·»åŠ MathJax CDNï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></div><div class="line">   <span class="attr">src</span>=<span class="string">"http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"</span>&gt;<span class="undefined"></span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>å°±å¯ä»¥åœ¨mdæ–‡ä»¶ä¸­æ’å…¥Texæ ¼å¼çš„å…¬å¼äº†ã€‚</p>
<p>è¡Œé—´å…¬å¼çš„å½¢å¼ä¸º<br><figure class="highlight gams"><table><tr><td class="code"><pre><div class="line"><span class="symbol">$</span><span class="symbol">$</span> æ­¤å¤„æ’å…¥å…¬å¼ <span class="symbol">$</span><span class="symbol">$</span></div></pre></td></tr></table></figure></p>
<p>è€Œè¡Œå†…å…¬å¼çš„å½¢å¼ä¸º<br><figure class="highlight livescript"><table><tr><td class="code"><pre><div class="line"><span class="string">\\(</span> æ­¤å¤„æ’å…¥å…¬å¼ <span class="string">\\)</span></div></pre></td></tr></table></figure></p>
<h1 id="Hexoä¸­æ˜¾ç¤ºæ•°å­¦å…¬å¼"><a href="#Hexoä¸­æ˜¾ç¤ºæ•°å­¦å…¬å¼" class="headerlink" title="Hexoä¸­æ˜¾ç¤ºæ•°å­¦å…¬å¼"></a>Hexoä¸­æ˜¾ç¤ºæ•°å­¦å…¬å¼</h1><p>HexoåŸç”Ÿä¸æ”¯æŒæ•°å­¦å…¬å¼ï¼Œ å› æ­¤éœ€è¦æˆ‘ä»¬åšä¸€äº›ä¿®æ”¹ã€‚å®‰è£…<a href="https://github.com/akfish/hexo-math" target="_blank" rel="external">hexo-math</a>æ’ä»¶ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line">npm install hexo-<span class="built_in">math</span> <span class="comment">--save</span></div></pre></td></tr></table></figure>
<p>åœ¨_config.ymlä¸­å¢åŠ <br><figure class="highlight avrasm"><table><tr><td class="code"><pre><div class="line"><span class="symbol">plugins:</span></div><div class="line">  hexo-math</div></pre></td></tr></table></figure></p>
<p>å®Œäº‹å¤§å‰ï¼Œ ä½ ç°åœ¨å¯ä»¥å†™LaTexå…¬å¼äº†ï¼Œ æˆ‘ä»¬æ¥å†™å‡ ä¸ªçœ‹çœ‹ã€‚</p>
<p>è¿™æ˜¯è¡Œå†…å…¬å¼æ ¹å·2è¿™æ ·å†™: \(\sqrt{2}\)<br><figure class="highlight taggerscript"><table><tr><td class="code"><pre><div class="line"><span class="symbol">\\</span>(<span class="symbol">\\</span>sqrt&#123;2&#125;<span class="symbol">\\</span>)</div></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯å•ç‹¬ä¸€è¡Œçš„å…¬å¼:<br><figure class="highlight gams"><table><tr><td class="code"><pre><div class="line"><span class="symbol">$</span><span class="symbol">$</span> a ^ <span class="number">2</span> + b ^ <span class="number">2</span> = c ^ <span class="number">2</span> <span class="symbol">$</span><span class="symbol">$</span></div><div class="line"><span class="symbol">$</span><span class="symbol">$</span> \<span class="built-in">sqrt</span>&#123;<span class="number">2</span>&#125; <span class="symbol">$</span><span class="symbol">$</span></div><div class="line"><span class="symbol">$</span><span class="symbol">$</span> evidence\_&#123;i&#125;=\<span class="keyword">sum</span> \_&#123;j&#125;W\_&#123;ij&#125;x\_&#123;j&#125;+b\_&#123;i&#125; <span class="symbol">$</span><span class="symbol">$</span></div></pre></td></tr></table></figure></p>
<p>$$ a ^ 2 + b ^ 2 = c ^ 2 $$<br>$$ \sqrt{2} $$<br>$$ evidence_{i}=\sum _{j}W_{ij}x_{j}+b_{i} $$<br>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œ é‡Œé¢æœ‰å¾ˆå¤š<strong>\\</strong>, <strong>\_</strong>ä¹‹ç±»ï¼Œ åŸå› æ˜¯<strong>\</strong>æœ¬èº«åœ¨markdownå’ŒLaTexé‡Œéƒ½æœ‰å«ä¹‰ï¼Œ å› æ­¤éœ€è¦è½¬ä¹‰ã€‚ä½†æ˜¯LaTexé‡Œé¢ï¼Œ <strong>\</strong>å¤ªå¸¸ç”¨äº†ï¼Œ æ‰€ä»¥æ¯æ¬¡é‡åˆ°éƒ½è½¬ä¹‰çš„è¯å°±å¾ˆç—›è‹¦ï¼Œ è€Œä¸”åœ¨hexoé‡Œé¢å†™çš„å…¬å¼ï¼Œå¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹å»å°±ä¸æ”¯æŒäº†ã€‚</p>
<p>ç½‘ä¸Šæœ‰æ”¹hexoæ¸²æŸ“çš„æºç çš„ï¼Œ æœ‰æ¢ç”¨pandocçš„ï¼Œ å…¶å®æœ€ç®€å•çš„æ–¹å¼æ˜¯ç”¨hexo-mathé‡Œçš„tagã€‚ç½‘ä¸Šæœç´¢åˆ°çš„å¾ˆå¤šèµ„æ–™éƒ½æ˜¯ç”¨çš„{&#37; math_block %}ï¼Œæˆ‘è¯•äº†å‘ç°æ€»æ˜¯ä¸å¯¹ï¼Œ åæ¥çœ‹<a href="https://github.com/akfish/hexo-math" target="_blank" rel="external">å®˜ç½‘</a>ï¼Œå‘ç°è¿™ä¸ªæ–¹æ³•å·²ç»deprecatedäº†ï¼Œ æœ€æ–°çš„ç”¨{&#37; math %}ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight django"><table><tr><td class="code"><pre><div class="line"><span class="xml">è¿™æ˜¯è¡Œå†…å…¬å¼ï¼š</span><span class="template-tag">&#123;% <span class="name">math</span> %&#125;</span><span class="xml">\sqrt&#123;2 + 3&#125;</span><span class="template-tag">&#123;% <span class="name">endmath</span> %&#125;</span><span class="xml"></span></div></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºä¸ºï¼šè¿™æ˜¯è¡Œå†…å…¬å¼ï¼š<span>$\sqrt{2 + 3}$</span><!-- Has MathJax --><br>ä¸€è¡Œå…¬å¼ï¼š<br><figure class="highlight tex"><table><tr><td class="code"><pre><div class="line"><span class="formula">$$ evidence<span class="tag">\<span class="name">_</span><span class="string">&#123;i&#125;</span>=</span><span class="tag">\<span class="name">sum</span></span> <span class="tag">\<span class="name">_</span><span class="string">&#123;j&#125;</span></span>W<span class="tag">\<span class="name">_</span><span class="string">&#123;ij&#125;</span></span>x<span class="tag">\<span class="name">_</span><span class="string">&#123;j&#125;</span></span>+b<span class="tag">\<span class="name">_</span><span class="string">&#123;i&#125;</span></span> $$</span></div><div class="line"></div><div class="line">&#123;<span class="comment">% math %&#125;</span></div><div class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;aligned&#125;</span></span></div><div class="line">evidence_&#123;i&#125;=<span class="tag">\<span class="name">sum</span></span> _&#123;j&#125;W_&#123;ij&#125;x_&#123;j&#125;+b_&#123;i&#125;</div><div class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;aligned&#125;</span></span></div><div class="line">&#123;<span class="comment">% endmath %&#125;</span></div></pre></td></tr></table></figure></p>
<p>$$ evidence_{i}=\sum _{j}W_{ij}x_{j}+b_{i} $$<br><span>$$\begin{aligned}
evidence_{i}=\sum _{j}W_{ij}x_{j}+b_{i}
\end{aligned}$$</span><!-- Has MathJax --><br>å¯ä»¥çœ‹å‡ºï¼Œ å¦‚æœæœ‰éœ€è¦è½¬ä¹‰çš„å­—ç¬¦ï¼Œ ç”¨{&#37; math %}tagè¿™ç§æ–¹å¼è¦å¥½å¾ˆå¤šã€‚</p>
<p>å†æ¥ä¸€ä¸ªå¤æ‚ç‚¹çš„å…¬å¼ï¼Œ è¿™æ˜¯<a href="https://www.tensorflow.org/tutorials/word2vec" target="_blank" rel="external">word2vec</a>çš„æŸå¤±å‡½æ•°å…¬å¼ï¼ˆé€‰ä¸­å…¬å¼ï¼Œ å³é”®å¯ä»¥æŸ¥çœ‹LaTexæºç ï¼‰ï¼š<br><figure class="highlight taggerscript"><table><tr><td class="code"><pre><div class="line">&#123;<span class="variable">% math %</span>&#125;</div><div class="line">J_<span class="symbol">\t</span>ext&#123;NEG&#125; = <span class="symbol">\l</span>og Q_<span class="symbol">\t</span>heta(D=1 |w_t, h) +</div><div class="line">  k <span class="symbol">\m</span>athop&#123;<span class="symbol">\m</span>athbb&#123;E&#125;&#125;_&#123;<span class="symbol">\t</span>ilde w <span class="symbol">\s</span>im P_<span class="symbol">\t</span>ext&#123;noise&#125;&#125;</div><div class="line">     <span class="symbol">\l</span>eft[ <span class="symbol">\l</span>og Q_<span class="symbol">\t</span>heta(D = 0 |<span class="symbol">\t</span>ilde w, h) <span class="symbol">\r</span>ight]</div><div class="line">&#123;<span class="variable">% endmath %</span>&#125;</div></pre></td></tr></table></figure></p>
<span>$$J_\text{NEG} = \log Q_\theta(D=1 |w_t, h) +
  k \mathop{\mathbb{E}}_{\tilde w \sim P_\text{noise}}
     \left[ \log Q_\theta(D = 0 |\tilde w, h) \right]$$</span><!-- Has MathJax -->
<p>ç»è¿‡ç®€å•çš„é…ç½®ï¼Œ æˆ‘ä»¬çš„webé¡µé¢å·²ç»å¯ä»¥æ”¯æŒå¾ˆæ–¹ä¾¿çš„ä¹¦å†™æ•°å­¦å…¬å¼äº†ï¼Œè€Œä¸”ç”±äºä¸ç”¨ç‰¹æ®Šè½¬ä¹‰ï¼Œ è¿™é‡Œå†™çš„LaTexå¯ä»¥åœ¨å…¶ä»–markdownç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œ æ¯”å¦‚<a href="http://mp.weixin.qq.com/s?__biz=MjM5NjAyNjkwMA==&amp;mid=2723942529&amp;idx=1&amp;sn=3b417dd77b4d5b92231ed59649844eb9&amp;chksm=81473ffab630b6ec843d77432c487e3e3a272ec26a5b9e0ae4007f5fce3dd826825a7b64a249&amp;mpshare=1&amp;scene=1&amp;srcid=0301zj3JKl85H692JGwUHZzM#rd" target="_blank" rel="external">æœ‰é“äº‘ç¬”è®°</a>ã€‚</p>
<p>============update===========</p>
<p>åˆšå‘ç°ç”±äºå¼•ç”¨äº†MathJax.jsï¼Œ æœ¬èº«åˆä¼šå¼•ç”¨å…¶ä»–ä¸€äº›jsã€cssä»¥åŠfontï¼Œ ä¼šå¤šå¢åŠ å·®ä¸å¤š100kèµ„æºï¼Œ å¹¶ä¸”ç”±äºéƒ½æ˜¯å›½å¤–çš„cdnï¼Œ é€Ÿåº¦å—é™åˆ¶ï¼ˆè²Œä¼¼è¿˜è¦ç¿»å¢™ï¼‰ï¼Œæ‰€ä»¥æ¯”è¾ƒå½±å“é˜…è¯»ä½“éªŒã€‚åç»­å†æƒ³åŠæ³•ä¼˜åŒ–å§ã€‚</p>
<p>============update===========<br>å‘ç°nextä¸»é¢˜å¥½çœ‹ä¸€äº›ï¼Œ æ¢æˆäº†nextã€‚ çœ‹åˆ°nextç›´æ¥<a href="http://theme-next.iissnan.com/third-party-services.html#others" target="_blank" rel="external">æ”¯æŒMathJax</a>çš„ï¼Œæ¢æˆäº†qiniuçš„cdnã€‚ä½†æ˜¯nextè‡ªå¸¦çš„mathï¼Œä¸èƒ½æ”¯æŒ{&#37; math %}ï¼Œå‘ç°è¿˜æ˜¯éœ€è¦hexo-mathï¼Œ è€Œä¸”å¾ˆå¥‡æ€ªçš„æ˜¯ï¼Œ å‘ç°ä¸ç”¨åœ¨_config.ymlé‡Œé¢å†™<br><figure class="highlight avrasm"><table><tr><td class="code"><pre><div class="line"><span class="symbol">plugins:</span></div><div class="line">  hexo-math</div></pre></td></tr></table></figure></p>
<p>å±…ç„¶ä¹Ÿå¯ä»¥ï¼Œ åªè¦package.jsoné‡Œé¢æœ‰hexo-mathå°±å¯ä»¥äº†ã€‚äºæ˜¯å‚è€ƒ<a href="https://github.com/akfish/hexo-math" target="_blank" rel="external">hexo-mathå®˜ç½‘</a>ï¼Œæ¢æˆäº†qiniuçš„cdnã€‚<br><figure class="highlight less"><table><tr><td class="code"><pre><div class="line"><span class="attribute">math</span>:</div><div class="line">  <span class="attribute">engine</span>: <span class="string">'mathjax'</span> # or <span class="string">'katex'</span></div><div class="line">  <span class="attribute">mathjax</span>:</div><div class="line">  <span class="attribute">src</span>: <span class="comment">//cdn.staticfile.org/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML</span></div></pre></td></tr></table></figure></p>
<p>å¥‡æ€ªçš„æ˜¯ï¼Œè¿˜æ˜¯æœ‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œä¸çŸ¥é“ä»å“ªé‡Œæ¥çš„ã€‚<br><figure class="highlight awk"><table><tr><td class="code"><pre><div class="line">https:<span class="regexp">//</span>cdn.mathjax.org<span class="regexp">/mathjax/</span>contrib<span class="regexp">/a11y/</span>accessibility-menu.js?V=<span class="number">2.7</span>.<span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>è€Œä¸”è¯´çš„<br><figure class="highlight arduino"><table><tr><td class="code"><pre><div class="line">Your <span class="built_in">config</span> will be merged into <span class="built_in">default</span> <span class="built_in">config</span>:</div></pre></td></tr></table></figure></p>
<p>ä¼¼ä¹ä¹Ÿæ²¡æœ‰ã€‚ç”Ÿæˆçš„ä»£ç ä¸º<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/x-mathjax-config"</span>&gt;</span><span class="actionscript"></span></div><div class="line">  MathJax.Hub.Config(<span class="string">""</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>é…ç½®ç›®æ²¡æœ‰äº†ï¼Ÿï¼ï¼å¥½åœ¨ä¼¼ä¹æ²¡æœ‰å½±å“ä½¿ç”¨ï¼Œé‚£å°±å…ˆæš‚æ—¶è¿™æ ·ç”¨ç€å§~~</p>
<p>[Refs]</p>
<ul>
<li><a href="http://jzqt.github.io/2015/06/30/Markdown%E4%B8%AD%E5%86%99%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/" target="_blank" rel="external">http://jzqt.github.io/2015/06/30/Markdown%E4%B8%AD%E5%86%99%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/</a></li>
<li><a href="https://www.zybuluo.com/codeep/note/163962" target="_blank" rel="external">https://www.zybuluo.com/codeep/note/163962</a></li>
<li><a href="http://oiltang.com/2014/05/04/markdown-and-mathjax/" target="_blank" rel="external">http://oiltang.com/2014/05/04/markdown-and-mathjax/</a></li>
<li><a href="http://www.jeyzhang.com/how-to-insert-equations-in-markdown.html" target="_blank" rel="external">http://www.jeyzhang.com/how-to-insert-equations-in-markdown.html</a></li>
<li><a href="http://www.52nlp.cn/%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E9%87%8C%E4%BD%BF%E7%94%A8latex%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F" target="_blank" rel="external">http://www.52nlp.cn/%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E9%87%8C%E4%BD%BF%E7%94%A8latex%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F</a></li>
<li><a href="https://github.com/mathjax/MathJax-node" target="_blank" rel="external">https://github.com/mathjax/MathJax-node</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘å‡†å¤‡å†™ä¸€ä¸‹æœºå™¨å­¦ä¹ çš„ä¸€äº›å­¦ä¹ ç¬”è®°ï¼Œ ç”±äºæ¶‰åŠåˆ°å¤§é‡æ•°å­¦å…¬å¼ï¼Œ å‘ç°ä¸æŠŠå¦‚ä½•åœ¨markdowné‡Œå†™æ•°å­¦å…¬å¼è¿™ä¸ªé—®é¢˜è§£å†³äº†ä¼šä¸¥é‡å½±å“å·¥ä½œæ•ˆç‡ã€‚å¤§æ¦‚è€Œè¨€ï¼Œ ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="ML" scheme="http://magicly.me/categories/ML/"/>
    
    
      <category term="math" scheme="http://magicly.me/tags/math/"/>
    
  </entry>
  
  <entry>
    <title>æœºå™¨å­¦ä¹ è®¡åˆ’</title>
    <link href="http://magicly.me/2017/02/12/ml-content/"/>
    <id>http://magicly.me/2017/02/12/ml-content/</id>
    <published>2017-02-12T14:04:10.000Z</published>
    <updated>2017-02-23T02:46:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœºå™¨å­¦ä¹ å·²ç»å½±å“äº†æˆ‘ä»¬ç”Ÿæ´»ä¸­çš„æ¯ä¸€ä¸ªåœ°æ–¹ï¼Œ äº†è§£ä¸€äº›æœºå™¨å­¦ä¹ çŸ¥è¯†ï¼Œ ä¾¿äºæé«˜ç«äº‰åŠ›ï¼Œ é¿å…è¢«æœºå™¨æ›¿ä»£ã€‚<br>ä¸‹é¢æ˜¯æˆ‘å‚è€ƒå’¨è¯¢äº†å¾ˆå¤šå¤§ç‰›ä¹‹åæœé›†æ•´ç†çš„ä¸€äº›å­¦ä¹ èµ„æ–™ï¼Œ åŸºæœ¬éƒ½æ˜¯è¯¥é¢†åŸŸä¸–ç•Œæœ€é¡¶å°–çš„é«˜æ‰‹äº²è‡ªæˆè¯¾ï¼Œä»¥åŠä¸€äº›æœ€æµè¡Œçš„å·¥å…·åº“ï¼Œ å€¼å¾—å­¦ä¹ ã€‚</p>
<a id="more"></a>
<p><em>. Andrew NG <a href="https://www.coursera.org/learn/machine-learningï¼ˆå·²å®Œæˆï¼‰" target="_blank" rel="external">https://www.coursera.org/learn/machine-learningï¼ˆå·²å®Œæˆï¼‰</a>
</em>. Andrew NG Unsupervised Feature Learning and Deep Learning <a href="http://deeplearning.stanford.edu/tutorial/ï¼ˆå­¦ä¹ ingï¼‰" target="_blank" rel="external">http://deeplearning.stanford.edu/tutorial/ï¼ˆå­¦ä¹ ingï¼‰</a><br><em>. <a href="http://neuralnetworksanddeeplearning.com/" target="_blank" rel="external">http://neuralnetworksanddeeplearning.com/</a> ï¼ˆå·²å®Œæˆï¼‰
</em>. Andrew NG, standfordçš„æœºå™¨å­¦ä¹ è¯¾ç¨‹ä¹‹ä¸€ï¼Œ <a href="http://cs229.stanford.edu/" target="_blank" rel="external">http://cs229.stanford.edu/</a><br><em>. Neural Networks for Machine Learning <a href="https://www.coursera.org/learn/neural-networks" target="_blank" rel="external">https://www.coursera.org/learn/neural-networks</a> by Geoffrey Hinton, Professor(æ·±åº¦å­¦ä¹ åˆ›å§‹äºº) ï¼ˆå­¦ä¹ ä¸­ï¼‰
</em>. æé£é£è¯¾ç¨‹<a href="http://cs231n.github.io/" target="_blank" rel="external">http://cs231n.github.io/</a><br><em>. æ–¯å¦ç¦è‡ªç„¶è¯­è¨€å¤„ç† <a href="http://web.stanford.edu/class/cs224n/" target="_blank" rel="external">http://web.stanford.edu/class/cs224n/</a>
</em>. Tensorflow for Deep Learning Research <a href="http://web.stanford.edu/class/cs20si/" target="_blank" rel="external">http://web.stanford.edu/class/cs20si/</a><br><em>. ä¼¯å…‹åˆ©äººå·¥æ™ºèƒ½è¯¾ç¨‹ <a href="http://www-inst.eecs.berkeley.edu/~cs188/archives.html" target="_blank" rel="external">http://www-inst.eecs.berkeley.edu/~cs188/archives.html</a>
</em>. <a href="http://www.deeplearningbook.org/" target="_blank" rel="external">http://www.deeplearningbook.org/</a>, by Ian Goodfellow and Yoshua Bengioï¼ˆæ·±åº¦å­¦ä¹ å››å¤§é‡‘åˆšä¹‹ä¸€ï¼‰ and Aaron Courville<br><em>. udacityæ·±åº¦å­¦ä¹ è¯¾ç¨‹tensorflow <a href="https://classroom.udacity.com/courses/ud730/ï¼ˆå­¦ä¹ ä¸­ï¼‰" target="_blank" rel="external">https://classroom.udacity.com/courses/ud730/ï¼ˆå­¦ä¹ ä¸­ï¼‰</a>
</em>. <a href="https://keras.io" target="_blank" rel="external">https://keras.io</a><br><em>. <a href="https://scikit-learn.org" target="_blank" rel="external">https://scikit-learn.org</a>
</em>. <a href="https://www.tensorflow.org" target="_blank" rel="external">https://www.tensorflow.org</a><br><em>. <a href="http://deeplearning.net/" target="_blank" rel="external">http://deeplearning.net/</a>
</em>. <a href="https://www.kaggle.com" target="_blank" rel="external">https://www.kaggle.com</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœºå™¨å­¦ä¹ å·²ç»å½±å“äº†æˆ‘ä»¬ç”Ÿæ´»ä¸­çš„æ¯ä¸€ä¸ªåœ°æ–¹ï¼Œ äº†è§£ä¸€äº›æœºå™¨å­¦ä¹ çŸ¥è¯†ï¼Œ ä¾¿äºæé«˜ç«äº‰åŠ›ï¼Œ é¿å…è¢«æœºå™¨æ›¿ä»£ã€‚&lt;br&gt;ä¸‹é¢æ˜¯æˆ‘å‚è€ƒå’¨è¯¢äº†å¾ˆå¤šå¤§ç‰›ä¹‹åæœé›†æ•´ç†çš„ä¸€äº›å­¦ä¹ èµ„æ–™ï¼Œ åŸºæœ¬éƒ½æ˜¯è¯¥é¢†åŸŸä¸–ç•Œæœ€é¡¶å°–çš„é«˜æ‰‹äº²è‡ªæˆè¯¾ï¼Œä»¥åŠä¸€äº›æœ€æµè¡Œçš„å·¥å…·åº“ï¼Œ å€¼å¾—å­¦ä¹ ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ML" scheme="http://magicly.me/categories/ML/"/>
    
    
      <category term="AI" scheme="http://magicly.me/tags/AI/"/>
    
      <category term="ML" scheme="http://magicly.me/tags/ML/"/>
    
      <category term="machine learning" scheme="http://magicly.me/tags/machine-learning/"/>
    
      <category term="deep learning" scheme="http://magicly.me/tags/deep-learning/"/>
    
      <category term="æ·±åº¦å­¦ä¹ " scheme="http://magicly.me/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>bezier-curve</title>
    <link href="http://magicly.me/2016/11/29/bezier-curve/"/>
    <id>http://magicly.me/2016/11/29/bezier-curve/</id>
    <published>2016-11-29T03:09:52.000Z</published>
    <updated>2016-11-29T09:49:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿"><a href="#ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿" class="headerlink" title="ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿"></a>ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿</h1><p>æœ€è¿‘åšä¸€ä¸ªåŠ¨ç”»æ•ˆæœæ—¶éœ€è¦å°†ç‰©ä½“åšæ›²çº¿ç§»åŠ¨ï¼Œ æœ¬æ¥è®°å¾—css3é‡Œçš„åŠ¨ç”»æ˜¯å¯ä»¥æŒ‡å®šbeizer curveçš„ï¼Œ ç»“æœç”¨çš„æ—¶å€™å‘ç°css3çš„beizer curveåªç”¨æ¥åšeasing timing functionã€‚ç®€å•æ¥è¯´å°±æ˜¯æ‹¿æ¥æ§åˆ¶åŠ¨ç”»â€œéçº¿æ€§â€ç§»åŠ¨ï¼Œæ¯”å¦‚è¶Šæ¥è¶Šå¿«ï¼ˆease-inï¼‰ï¼Œ è¶Šæ¥è¶Šæ…¢ï¼ˆease-outï¼‰ï¼Œå…ˆæ…¢åå¿«å†æ…¢ï¼ˆease-in-outï¼‰ç­‰ï¼Œ è®©åŠ¨ç”»æ•ˆæœæ›´â€œçµåŠ¨â€ï¼Œ é¿å…çº¿æ€§ï¼ˆlinearï¼‰çš„æ­»æ¿ã€‚</p>
<p>å¯ä»¥çœ‹çœ‹è¿™ä¸¤ä¸ªé¡µé¢ï¼Œ æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ã€‚</p>
<a id="more"></a>
<ul>
<li><a href="http://cubic-bezier.com/" target="_blank" rel="external">http://cubic-bezier.com/</a></li>
<li><a href="http://easings.net/zh-cn" target="_blank" rel="external">http://easings.net/zh-cn</a></li>
</ul>
<p>beizer curveåœ¨css3ä¸­çš„ä½¿ç”¨ï¼Œ å¯ä»¥è‡ªå·±googleä¸€ä¸‹ï¼Œ æˆ–è€…çœ‹ä¸‹ï¼š</p>
<ul>
<li><a href="http://www.w3school.com.cn/css3/css3_transition.asp" target="_blank" rel="external">http://www.w3school.com.cn/css3/css3_transition.asp</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/02/css_transition_and_animation.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2014/02/css_transition_and_animation.html</a></li>
</ul>
<p>å¼•ç”¨wikiä¸Šçš„ä»‹ç»ï¼š<br><figure class="highlight armasm"><table><tr><td class="code"><pre><div class="line">åœ¨æ•°å­¦çš„æ•°å€¼åˆ†æé¢†åŸŸä¸­ï¼Œè´å¡å°”æ›²çº¿ï¼ˆè‹±è¯­ï¼š<span class="keyword">BÃ©zier </span>curveï¼‰æ˜¯è®¡ç®—æœºå›¾å½¢å­¦ä¸­ç›¸å½“é‡è¦çš„å‚æ•°æ›²çº¿ã€‚æ›´é«˜ç»´åº¦çš„å¹¿æ³›åŒ–è´å¡å°”æ›²çº¿å°±ç§°ä½œè´å¡å°”æ›²é¢ï¼Œå…¶ä¸­è´å¡å°”ä¸‰è§’æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®ä¾‹ã€‚</div><div class="line">è´å¡å°”æ›²çº¿äº<span class="number">1962</span>å¹´ï¼Œç”±æ³•å›½å·¥ç¨‹å¸ˆçš®åŸƒå°”Â·è´å¡å°”ï¼ˆPierre <span class="keyword">BÃ©zierï¼‰æ‰€å¹¿æ³›å‘è¡¨ï¼Œä»–è¿ç”¨è´å¡å°”æ›²çº¿æ¥ä¸ºæ±½è½¦çš„ä¸»ä½“è¿›è¡Œè®¾è®¡ã€‚è´å¡å°”æ›²çº¿æœ€åˆç”±Paul </span>de Casteljauäº<span class="number">1959</span>å¹´è¿ç”¨de Casteljauç®—æ³•å¼€å‘ï¼Œä»¥ç¨³å®šæ•°å€¼çš„æ–¹æ³•æ±‚å‡ºè´å¡å°”æ›²çº¿ã€‚</div></pre></td></tr></table></figure></p>
<p>æœ‰æ•°å­¦åŠŸåº•æˆ–è€…æœ‰å…´è¶£çš„å¯ä»¥å‚è€ƒä¸‹é¢å‡ ç¯‡æ–‡ç« ï¼Œ æˆ‘å°±ä¸èµ˜è¿°äº†ï¼ˆæœ€è®¨åŒé‚£ç§ä»€ä¹ˆéƒ½è¦copyè¿‡æ¥ï¼Œå¼„å¾—å¥½åƒè·Ÿæ˜¯è‡ªå·±å†™çš„æ ·ï¼Œ åˆ«äººå·²ç»å†™å¾—å¾ˆæ¸…æ¥šäº†ï¼Œ å¹²å˜›å†é‡å¤åŠ³åŠ¨ä¸€éå‘¢ï¼Œ åˆæ²¡æœ‰è‡ªå·±çš„æ–°çš„è§è§£ï¼Œèµ äººé“¾æ¥ï¼Œ æ‰‹ç•™ä½™é¦™ã€‚ ğŸ˜å“ˆï¼‰ã€‚</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve" target="_blank" rel="external">https://en.wikipedia.org/wiki/B%C3%A9zier_curve</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E8%8C%B2%E6%9B%B2%E7%B7%9A" target="_blank" rel="external">https://zh.wikipedia.org/wiki/%E8%B2%9D%E8%8C%B2%E6%9B%B2%E7%B7%9A</a></li>
<li><a href="http://www.html-js.com/article/1628" target="_blank" rel="external">http://www.html-js.com/article/1628</a></li>
<li><a href="http://www.cnblogs.com/hnfxs/p/3148483.html" target="_blank" rel="external">http://www.cnblogs.com/hnfxs/p/3148483.html</a></li>
<li></li>
</ul>
<h1 id="åœ¨çº¿å·¥å…·"><a href="#åœ¨çº¿å·¥å…·" class="headerlink" title="åœ¨çº¿å·¥å…·"></a>åœ¨çº¿å·¥å…·</h1><p>ä¸‹é¢æ˜¯å‡ ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„å·¥å…·ï¼Œ æ–¹ä¾¿å¤§å®¶ã€‚</p>
<ul>
<li><a href="http://blogs.sitepointstatic.com/examples/tech/canvas-curves/quadratic-curve.html" target="_blank" rel="external">http://blogs.sitepointstatic.com/examples/tech/canvas-curves/quadratic-curve.html</a></li>
<li><a href="http://myst729.github.io/bezier-curve/" target="_blank" rel="external">http://myst729.github.io/bezier-curve/</a></li>
<li><a href="http://xuanfengge.com/easeing/ceaser/" target="_blank" rel="external">http://xuanfengge.com/easeing/ceaser/</a></li>
<li><a href="http://yisibl.github.io/cubic-bezier/#.17,.67,.83,.67" target="_blank" rel="external">http://yisibl.github.io/cubic-bezier/#.17,.67,.83,.67</a></li>
<li><a href="http://cubic-bezier.com/#.17,.67,.83,.67" target="_blank" rel="external">http://cubic-bezier.com/#.17,.67,.83,.67</a></li>
</ul>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>å‰é¢èµ„æ–™éƒ½æ˜¯æŠŠbezier curveæ‹¿æ¥å½“timing functionçš„ï¼Œ è€Œæˆ‘çš„éœ€æ±‚æ˜¯è¦è®©ç‰©ä½“ï¼ˆæŸä¸ªdomèŠ‚ç‚¹ï¼‰æ²¿ç€æŸæ¡beizer curveç§»åŠ¨ï¼Œäºæ˜¯ç»§ç»­googleï¼Œ æ‰¾åˆ°äº†å‡ ä¸ªã€‚</p>
<ul>
<li>Androidå®ç°: <a href="https://github.com/Yasic/QQBubbleView" target="_blank" rel="external">https://github.com/Yasic/QQBubbleView</a></li>
</ul>
<p>Androidçš„æˆ‘ç”¨ä¸åˆ°ï¼Œ æ”¾è¿™é‡Œä¸»è¦æ˜¯é‡Œé¢çš„gifå›¾å¾ˆç›´è§‚ï¼Œå“ˆå“ˆã€‚</p>
<ul>
<li>CSSå®ç°ï¼š<a href="http://jinlong.github.io/2016/01/14/moving-along-a-curved-path-in-css-with-layered-animation/ï¼Œ" target="_blank" rel="external">http://jinlong.github.io/2016/01/14/moving-along-a-curved-path-in-css-with-layered-animation/ï¼Œ</a> åŸæ–‡ï¼š<a href="http://tobiasahlin.com/blog/curved-path-animations-in-css/" target="_blank" rel="external">http://tobiasahlin.com/blog/curved-path-animations-in-css/</a></li>
</ul>
<p>CSSçš„å®ç°çœŸæ˜¯ç›¸å½“trickyï¼Œ æˆ‘è§£é‡Šä¸€ä¸‹ã€‚CSSé‡Œé¢çš„animation translateæ˜¯ç›´æ¥æŒ‰ç…§ç›´çº¿ç§»åŠ¨åˆ°ç›®çš„åœ°çš„ï¼Œ è¿™æ˜¯å› ä¸ºæ²¿Xè½´å’ŒYè½´éƒ½æ˜¯åŒ€é€Ÿè¿åŠ¨ï¼ˆlinearï¼‰ï¼Œæ‰€ä»¥åˆæˆä¹‹åçš„é€Ÿåº¦å¿…ç„¶æ˜¯æ–œè§’45Â°ç§»åŠ¨è¿‡å»çš„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠXè½´çœ‹æˆæ—¶é—´è½´ï¼Œ è¿™æ—¶å¦‚æœYè½´çš„ç§»åŠ¨å‡½æ•°æ˜¯æŸä¸ªbeizer curveï¼Œé‚£åˆæˆä¹‹åçš„ç§»åŠ¨æ›²çº¿å°±æ˜¯beizer curveäº†ã€‚å…·ä½“å®ç°çš„æ—¶å€™è¿˜ç”¨åˆ°äº†:afterä¼ªå…ƒç´ äº†ã€‚</p>
<p>å¤æ‚ä¸€ç‚¹çš„æˆ‘è§‰å¾—è¿˜æ˜¯éœ€è¦ç”¨jså»æ§åˆ¶ï¼Œ äºæ˜¯è‡ªç„¶æƒ³åˆ°äº†ç”¨jsä»£ç å»æŒ‰ç…§beizer curveå…¬å¼å®ç°ã€‚</p>
<ul>
<li>JSå®ç°ï¼š <a href="http://blog.csdn.net/cuixiping/article/details/6872095" target="_blank" rel="external">http://blog.csdn.net/cuixiping/article/details/6872095</a></li>
</ul>
<p>è¿™ä¸ªç”¨çš„å…¬å¼ä¸ç›´è§‚ï¼Œåº”è¯¥æ˜¯è¿›è¡Œäº†å˜æ¢ä¹‹åçš„ï¼Œ æˆ‘ç›´æ¥ç…§ç€å…¬å¼å†™äº†ä¸€ä¸ªã€‚<br><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function">function <span class="title">PointOnCubicBezier2</span><span class="params">(cp, t)</span>  </span>&#123;</div><div class="line">   <span class="comment">// B(t) = P0 * (1-t)^3 + 3 * P1 * t * (1-t)^2 + 3 * P2 * t^2 * (1-t) + P3 * t^3</span></div><div class="line">        <span class="keyword">const</span> <span class="keyword">one_t</span> = <span class="number">1.0</span> - t;</div><div class="line">        <span class="keyword">const</span> P0 = cp[<span class="number">0</span>];</div><div class="line">        <span class="keyword">const</span> P1 = cp[<span class="number">1</span>];</div><div class="line">        <span class="keyword">const</span> P2 = cp[<span class="number">2</span>];</div><div class="line">        <span class="keyword">const</span> P3 = cp[<span class="number">3</span>];</div><div class="line">        <span class="keyword">const</span> x =  (P0.x * Math.<span class="built_in">pow</span>(<span class="keyword">one_t</span>, <span class="number">3</span>) + <span class="number">3</span> * P1.x * t * Math.<span class="built_in">pow</span>(<span class="keyword">one_t</span>, <span class="number">2</span>) + <span class="number">3</span> * P2.x * Math.<span class="built_in">pow</span>(t, <span class="number">2</span>) * <span class="keyword">one_t</span> + P3.x * Math.<span class="built_in">pow</span>(t, <span class="number">3</span>));</div><div class="line">        <span class="keyword">const</span> y =  (P0.y * Math.<span class="built_in">pow</span>(<span class="keyword">one_t</span>, <span class="number">3</span>) + <span class="number">3</span> * P1.y * t * Math.<span class="built_in">pow</span>(<span class="keyword">one_t</span>, <span class="number">2</span>) + <span class="number">3</span> * P2.y * Math.<span class="built_in">pow</span>(t, <span class="number">2</span>) * <span class="keyword">one_t</span> + P3.y * Math.<span class="built_in">pow</span>(t, <span class="number">3</span>));</div><div class="line">        <span class="keyword">const</span> pointF = <span class="keyword">new</span> Point2D(x, y);</div><div class="line">        <span class="keyword">return</span> pointF;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹æ¯”äº†ä¸€ä¸‹ä¸¤ä¸ªå‡½æ•°çš„è¾“å‡ºå€¼ï¼Œ å®Œå…¨æ˜¯ä¸€æ ·çš„ï¼Œ åº”è¯¥å°±æ˜¯æ•°å­¦å˜æ¢è€Œå·²ï¼Œ æˆ‘æ‡’å¾—å»åšæ¨å€’äº†ã€‚</p>
<p>åæ¥æ‰¾åˆ°ä¸€ä¸ªä¸‰é˜¶beizer curveçš„å®ç°ï¼Œçœ‹è¿™é‡Œ<br><a href="https://github.com/gre/bezier-easingï¼Œ" target="_blank" rel="external">https://github.com/gre/bezier-easingï¼Œ</a> è¿™ä¸ªå®ç°å¯èƒ½æœ‰ç‚¹NBï¼Œä»¥è‡³äº<a href="https://facebook.github.io/react-native/" target="_blank" rel="external">React Native</a>ã€<a href="http://velocityjs.org/" target="_blank" rel="external">Velocity</a>ç­‰é¡¹ç›®éƒ½ä½¿ç”¨äº†ï¼Œå±Œå±Œçš„ã€‚</p>
<p>ç”¨<a href="https://github.com/bestiejs/benchmark.js" target="_blank" rel="external">benchmark</a>è·‘ä¸€ä¸‹åˆ†ï¼š<a href="https://jsperf.com/beizer-curve5" target="_blank" rel="external">çœ‹è¿™é‡Œ</a>ï¼Œ chromeä¸‹æˆ‘å†™çš„æ–¹æ³•å±…ç„¶æ…¢äº†94%ï¼çœ‹æ ·å­ä»£ç å¯è¯»æ€§æ˜¯è¦ä»˜å‡ºä»£ä»·çš„å“ˆã€‚æˆ‘è¿˜æ˜¯è€è€å®å®ç”¨<a href="https://github.com/gre/bezier-easingå§ã€‚" target="_blank" rel="external">https://github.com/gre/bezier-easingå§ã€‚</a></p>
<p>åˆšåˆšåˆæœåˆ°ä¸€ç¯‡æ–‡ç« ï¼Œ è®²è§£åœ°æ›´ç»†è‡´æ·±å…¥ï¼Œ å®³å¾—æˆ‘ä¸æƒ³ç»§ç»­å†™äº†ã€‚ ç›´æ¥çœ‹è¿™é‡Œå§ã€‚<a href="http://www.jianshu.com/p/55c721887568" target="_blank" rel="external">http://www.jianshu.com/p/55c721887568</a></p>
<h1 id="å¦‚ä½•å°†å¤šä¸ªç‚¹ç”¨è´å¡å°”æ›²çº¿è¿èµ·æ¥"><a href="#å¦‚ä½•å°†å¤šä¸ªç‚¹ç”¨è´å¡å°”æ›²çº¿è¿èµ·æ¥" class="headerlink" title="å¦‚ä½•å°†å¤šä¸ªç‚¹ç”¨è´å¡å°”æ›²çº¿è¿èµ·æ¥"></a>å¦‚ä½•å°†å¤šä¸ªç‚¹ç”¨è´å¡å°”æ›²çº¿è¿èµ·æ¥</h1><ul>
<li><a href="http://www.zheng-hang.com/?id=43" target="_blank" rel="external">http://www.zheng-hang.com/?id=43</a></li>
<li><a href="http://www.cnblogs.com/hnfxs/p/3148743.html" target="_blank" rel="external">http://www.cnblogs.com/hnfxs/p/3148743.html</a></li>
<li></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯è´å¡å°”æ›²çº¿&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åšä¸€ä¸ªåŠ¨ç”»æ•ˆæœæ—¶éœ€è¦å°†ç‰©ä½“åšæ›²çº¿ç§»åŠ¨ï¼Œ æœ¬æ¥è®°å¾—css3é‡Œçš„åŠ¨ç”»æ˜¯å¯ä»¥æŒ‡å®šbeizer curveçš„ï¼Œ ç»“æœç”¨çš„æ—¶å€™å‘ç°css3çš„beizer curveåªç”¨æ¥åšeasing timing functionã€‚ç®€å•æ¥è¯´å°±æ˜¯æ‹¿æ¥æ§åˆ¶åŠ¨ç”»â€œéçº¿æ€§â€ç§»åŠ¨ï¼Œæ¯”å¦‚è¶Šæ¥è¶Šå¿«ï¼ˆease-inï¼‰ï¼Œ è¶Šæ¥è¶Šæ…¢ï¼ˆease-outï¼‰ï¼Œå…ˆæ…¢åå¿«å†æ…¢ï¼ˆease-in-outï¼‰ç­‰ï¼Œ è®©åŠ¨ç”»æ•ˆæœæ›´â€œçµåŠ¨â€ï¼Œ é¿å…çº¿æ€§ï¼ˆlinearï¼‰çš„æ­»æ¿ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹çœ‹è¿™ä¸¤ä¸ªé¡µé¢ï¼Œ æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="FE" scheme="http://magicly.me/categories/FE/"/>
    
    
      <category term="js" scheme="http://magicly.me/tags/js/"/>
    
      <category term="css" scheme="http://magicly.me/tags/css/"/>
    
      <category term="animation" scheme="http://magicly.me/tags/animation/"/>
    
      <category term="beizer curve" scheme="http://magicly.me/tags/beizer-curve/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨webhookå®ç°github pagesçš„è‡ªåŠ¨éƒ¨ç½²</title>
    <link href="http://magicly.me/2015/09/16/auto-deploy-githubPages-by-webhook-md/"/>
    <id>http://magicly.me/2015/09/16/auto-deploy-githubPages-by-webhook-md/</id>
    <published>2015-09-16T10:12:39.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://blog.coderzh.com/2015/09/13/use-webhook-automated-deploy-hugo/?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io" target="_blank" rel="external">http://blog.coderzh.com/2015/09/13/use-webhook-automated-deploy-hugo/?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io</a></p>
<p>â€¦</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://blog.coderzh.com/2015/09/13/use-webhook-automated-deploy-hugo/?hmsr=toutiao.io&amp;amp;utm_medium=toutiao.io&amp;amp;utm_source=t
    
    </summary>
    
      <category term="default" scheme="http://magicly.me/categories/default/"/>
    
    
      <category term="github" scheme="http://magicly.me/tags/github/"/>
    
      <category term="webhook" scheme="http://magicly.me/tags/webhook/"/>
    
      <category term="ssh" scheme="http://magicly.me/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>javascriptç®­å¤´å‡½æ•°</title>
    <link href="http://magicly.me/2015/09/07/js-arrow-functions-md/"/>
    <id>http://magicly.me/2015/09/07/js-arrow-functions-md/</id>
    <published>2015-09-07T12:48:42.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>javascript es6 arrow function.</p>
<a id="more"></a>
<p>å¼€å§‹å­¦ä¹ ES6.<br><a href="https://hacks.mozilla.org/category/es6-in-depth/" target="_blank" rel="external">https://hacks.mozilla.org/category/es6-in-depth/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;javascript es6 arrow function.&lt;/p&gt;
    
    </summary>
    
      <category term="JS" scheme="http://magicly.me/categories/JS/"/>
    
    
      <category term="js" scheme="http://magicly.me/tags/js/"/>
    
      <category term="javascript" scheme="http://magicly.me/tags/javascript/"/>
    
      <category term="es6" scheme="http://magicly.me/tags/es6/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨SSHåå‘é€šé“åœ¨æœ¬åœ°è°ƒè¯•å¾®ä¿¡å…¬å…±å·</title>
    <link href="http://magicly.me/2015/07/26/ssh-reverse-tunnel-wx-local/"/>
    <id>http://magicly.me/2015/07/26/ssh-reverse-tunnel-wx-local/</id>
    <published>2015-07-26T03:40:25.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¾®ä¿¡å…¬å…±å·ç°åœ¨å¾ˆç«ï¼Œä¸€äº›ç®€å•çš„åº”ç”¨ï¼Œåšä¸€ä¸ªå…¬å…±å·æ¯”å¼€å‘ä¸€æ¬¾appæˆæœ¬è¦å°å¾ˆå¤šï¼Œè€Œä¸”åˆ©ç”¨æœ‹å‹åœˆçš„è½¬å‘ï¼Œç›¸æ¯”appå»app storeé‡Œä¸Šæ¶ç­‰ç€ç”¨æˆ·ä¸‹è½½ï¼Œè¦å®¹æ˜“å¾ˆå¤šã€‚</p>
<p>ä½†æ˜¯å¾®ä¿¡å…¬å…±å·çš„è°ƒè¯•æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œå¿…é¡»åœ¨å¾®ä¿¡<a href="https://mp.weixin.qq.com/" target="_blank" rel="external">ç®¡ç†åå°</a>é…ç½®ä¸€ä¸ªå¾®ä¿¡èƒ½è®¿é—®åˆ°ï¼ˆå…¬ç½‘ï¼‰çš„urlï¼Œç„¶ååœ¨å…¬å…±å·é‡Œè¾“å…¥å†…å®¹ï¼Œå¾®ä¿¡ä»¥xmlæ ¼å¼è½¬å‘ç»™è¿™ä¸ªurlï¼Œurlå›å¤ä¹‹åå¾®ä¿¡å†å°†responseå›å¤ç»™ä½¿ç”¨å…¬å…±å·çš„å¾®ä¿¡ç”¨æˆ·ã€‚å½“ç„¶å¾®ä¿¡ä¹Ÿæä¾›äº†<a href="http://mp.weixin.qq.com/debug" target="_blank" rel="external">è°ƒè¯•å·¥å…·</a>ï¼Œ å¯ä»¥ç›´æ¥æ„é€ æ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•å„ä¸ªæ¥å£ã€‚ ä½†æ˜¯ä¾ç„¶éœ€è¦ä¸€ä¸ªå…¬ç½‘çš„urlä½œä¸ºæ¥å£ã€‚äºæ˜¯æœ€åŸå§‹çš„å¼€å‘æ–¹å¼å°±æ˜¯ï¼Œä¿®æ”¹ä»£ç ï¼Œä¸Šä¼ åˆ°serverï¼Œï¼ˆå¦‚æœæ˜¯æœ‰äº›é™æ€è¯­è¨€è¿˜éœ€è¦é‡å¯æœåŠ¡å™¨ï¼‰ï¼Œç„¶åçœ‹æ˜¯å¦æ­£å¸¸workï¼Œå¦‚æœä¸è¡Œçš„è¯ï¼Œåœ¨å¯èƒ½é”™è¯¯çš„åœ°æ–¹æ‰“å‡ºlogï¼Œç„¶ååˆæ˜¯ä¿®æ”¹ä»£ç ï¼Œä¸Šä¼ serverï¼Œé‡å¯ã€‚ã€‚ã€‚ã€‚ã€‚å°±è¿™æ ·ï¼Œæ¯æ¬¡æ”¹ä¸€ç‚¹ç‚¹ï¼Œä½ éƒ½å¯ä»¥æ³¡æ¯å’–å•¡äº†ï¼Œè€æ¿å°±ä¼šè§‰å¾—ä½ å¾ˆé—²ã€‚å‚çœ‹<a href="http://www.oschina.net/news/15579/reasons-why-people-who-work-with-computers-seem-to" target="_blank" rel="external">ä¸ºä»€ä¹ˆæè®¡ç®—æœºå·¥ä½œçš„äººæ€»æ˜¯çœ‹ä¸Šå»å¾ˆæ¸…é—²</a>ã€‚</p>
<a id="more"></a>
<p>æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°è°ƒè¯•å‘¢ï¼Œç®€å•è¯´ï¼Œå°±æ˜¯å¾®ä¿¡æŠŠæ•°æ®ä¼ åˆ°æˆ‘æœ¬åœ°çš„ç”µè„‘ä¸Šï¼Œæˆ‘æ¯æ¬¡æ”¹å®Œä»£ç ï¼Œä¸ç”¨é‡æ–°ä¸Šä¼ serverï¼Œç›´æ¥åœ¨æœ¬åœ°åŠ logç­‰ã€‚ç»è¿‡ç ”ç©¶ï¼Œæ‰¾åˆ°å‡ ä¸ªæ–¹æ³•ï¼Œè®°å½•ä¸‹æ¥ï¼Œä¸å¤§å®¶åˆ†äº«ï¼Œç»å¯¹èƒ½èŠ‚çº¦å¾ˆå¤šå¾ˆå¤šå¾ˆå¤šæ—¶é—´ï¼Œç„¶åå°±å¯ä»¥å»é™ªå¦¹çº¸äº†ï¼Œ å¦‚æœä½ æœ‰çš„è¯ï¼Œæ²¡æœ‰çš„è¯<a href="http://www.zhihu.com/question/20385321" target="_blank" rel="external">here</a>ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä½ æœ¬åœ°ç”µè„‘æœ‰å…¬ç½‘ipã€‚æ¯”å¦‚å®¶é‡Œå®½å¸¦ï¼Œæ²¡ç”¨è·¯ç”±ï¼Œç›´æ¥æŠŠç½‘çº¿æ’ä¸Šï¼Œåº”è¯¥å°±æ˜¯å…¬ç½‘IPï¼Œå§ã€‚ å¦‚æœå®¶é‡Œæœ‰å¤šäººä½¿ç”¨ï¼Œä½ å¯ä»¥å†è·¯ç”±å™¨é‡Œé…ç½®NATåœ°å€è½¬æ¢ã€‚è‡ªè¡Œ<a href="https://www.google.com.hk/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#q=NAT%20%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2" target="_blank" rel="external">Google</a>å§ã€‚</p>
<p>ç¬¬äºŒç§ï¼Œä¹Ÿæ˜¯æˆ‘æœåˆ°çš„æœ€å¤šçš„ï¼Œç”¨ngrokè¿™ä¸ªç¥å™¨ï¼ç½‘ä¸Šä¸€å †èµ„æ–™ï¼Œæ¯”å¦‚<a href="http://www.mbnow.tk/2014/12/05/ngrok/" target="_blank" rel="external">è¿™ä¸ª</a>ï¼Œæˆ‘Googleåˆ°çš„æœ€å¤šçš„ä¹Ÿæ˜¯è¿™ä¸ªï¼Œè€Œä¸”çœ‹ä¸Šå»ä¹Ÿåº”è¯¥å¾ˆç®€å•ã€‚ <a href="http://www.oray.com/" target="_blank" rel="external">èŠ±ç”Ÿå£³</a>æˆ‘10å¹´å‰ç”¨è¿‡ï¼ˆxï¼Œä¸å°å¿ƒæš´éœ²å¹´é¾„äº†ï¼‰ï¼Œåº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚ç½‘ä¸Šè¯´ï¼Œç¼ºç‚¹æ˜¯</p>
<blockquote>
<p>ä¸è¿‡ ngrok é€Ÿåº¦è¾ƒæ…¢ï¼Œå¾®ä¿¡æœåŠ¡å™¨å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜ï¼Œæ¯æ¬¡é€šä¿¡è¶…è¿‡ 5 ç§’ä¾¿è¶…æ—¶ï¼Œæ‰€ä»¥æ­¤æ³•ä¹Ÿä¸å»ºè®®ä½¿ç”¨ã€‚</p>
</blockquote>
<p>æˆ‘è§‰å¾—ç”¨èŠ±ç”Ÿå£³çš„è¯å¯èƒ½å¥½ç‚¹ï¼Œå› ä¸ºæ˜¯å›½å†…çš„ï¼ˆæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»è¯•è¯•å“ˆï¼‰ã€‚æ²¡æœ‰ç”¨ngrokè¯•ä¸€ä¸‹ï¼Œå› ä¸ºâ€œæ— æ³•æ˜¾ç¤ºæ­¤ç½‘é¡µâ€ï¼ç½‘ä¸Šå°±æ˜¯â€œéª—å­â€å¤šï¼Œæ˜æ˜æ²¡æœ‰çš„ç½‘ç«™ï¼Œå¤§å®¶éƒ½æç»˜çš„ç»˜å£°ç»˜è‰²ã€‚</p>
<p>ç¬¬ä¸‰ç§ï¼Œç”¨sshå»ºç«‹åå‘é€šé“ã€‚å¯¹äº†ï¼Œä½¿ç”¨æ­¤ç§æ–¹æ³•ï¼Œä½ è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå…¬ç½‘IPçš„ã€‚ ä½œä¸ºä¸€åä¸“ä¸šå·¥ç¨‹å¸ˆï¼Œæ‹¥æœ‰å…¬ç½‘ ip åœ°å€çš„ VPS æœåŠ¡å™¨åŸºæœ¬æˆäº†æ ‡é…ï¼Œ<a href="http://www.qcloud.com/redirect.php?redirect=1002&amp;cps_key=0a3641075e434bf76a016a44d2918e4a" target="_blank" rel="external">è…¾è®¯äº‘VPS</a> æœ€ä¾¿å®œçš„ä¸€æ¬¾æ¯å¹´ä¹Ÿå°±å‡ ç™¾å—é’±ï¼Œå¹³æ—¶æŒ‚æŒ‚è‡ªå·±å–œæ¬¢çš„æœåŠ¡ï¼Œåšä¸ªç«™é•¿ï¼Œè·‘è·‘è‡ªå·±çš„å¼€æºé¡¹ç›®ç”šçˆ½ã€‚</p>
<ol>
<li>ç”³è¯·<a href="http://www.qcloud.com/redirect.php?redirect=1001&amp;cps_key=0a3641075e434bf76a016a44d2918e4a" target="_blank" rel="external">è…¾è®¯äº‘</a></li>
<li>æœ¬åœ°å®‰è£…sshï¼Œå¦‚æœæ˜¯linuxæˆ–macï¼Œéƒ½æ˜¯è‡ªå¸¦çš„ã€‚å¦‚æœæ˜¯windowsçš„è¯ï¼Œå¯ä»¥å®‰è£…<a href="https://www.cygwin.com/" target="_blank" rel="external">Cygwin</a>ï¼Œå¦‚æœä½ å«Œå¼ƒå®ƒå¤ªé‡äº†ï¼Œå®‰è£…äº†<a href="https://git-scm.com/download/gui/win" target="_blank" rel="external">Git</a>ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¦‚æœä½ ä¹Ÿä¸æƒ³è£…æˆ–è€…ä¸ä¼šè£…Gitï¼Œé¢ï¼Œ(âŠ™oâŠ™)â€¦ï¼Œå¥½å§ï¼Œé‚£ä½ è¿˜æ˜¯ä¸è¦å†™ç¨‹åºäº†ã€‚</li>
<li>å»ºç«‹sshåå‘é€šé“ã€‚<br>è¿™ä¸€æ­¥é‡Œæœ‰å¾ˆå¤šå‘ï¼Œæˆ‘èŠ±äº†å·®ä¸å¤šä¸€å¤©æ‰å®Œå…¨æå®šã€‚ä½ ä»¬å¯ä»¥å…ˆå‚è€ƒè¿™å‡ ç¯‡æ–‡ç« ï¼Œäº†è§£ä¸‹åŸç†å•¥çš„ã€‚<ul>
<li><a href="http://blog.zjutoe.net/?p=95" target="_blank" rel="external">http://blog.zjutoe.net/?p=95</a></li>
<li><a href="http://my.oschina.net/abcfy2/blog/177094" target="_blank" rel="external">http://my.oschina.net/abcfy2/blog/177094</a></li>
<li><a href="http://www.zzbaike.com/wiki/PuTTY/Putty%E5%BB%BA%E7%AB%8B%E9%9A%A7%E9%81%93%E7%9A%84%E6%96%B9%E6%B3%95" target="_blank" rel="external">http://www.zzbaike.com/wiki/PuTTY/Putty%E5%BB%BA%E7%AB%8B%E9%9A%A7%E9%81%93%E7%9A%84%E6%96%B9%E6%B3%95</a></li>
<li><a href="http://www.freeoa.net/osuport/netmanage/linux-ssh-tunneling-proxy_1892.html" target="_blank" rel="external">http://www.freeoa.net/osuport/netmanage/linux-ssh-tunneling-proxy_1892.html</a></li>
<li><a href="https://qdan.me/list/VOSXmsI4tv7fIciF" target="_blank" rel="external">https://qdan.me/list/VOSXmsI4tv7fIciF</a></li>
</ul>
</li>
</ol>
<p>å¥½å§ï¼Œæ¥çœ‹æˆ‘çš„å…·ä½“ä¸€æ­¥ä¸€æ­¥åšæ³•ã€‚</p>
<ol>
<li><p>ssh -R 9999:localhost:9000 ubuntu@myserver_ip_addressï¼Œè¾“å…¥å¯†ç </p>
</li>
<li><p>serverä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦ç›‘å¬äº†9999ç«¯å£ï¼Œnetstat -anltp | grep 9999</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ubuntu@VM-39-45-ubuntu:~$ netstat -anltp | grep 9999</div><div class="line">(Not all processes could be identified, non-owned process info</div><div class="line">will not be shown, you would have to be root to see it all.)</div><div class="line">tcp        0      0 127.0.0.1:9999          0.0.0.0:*               LISTEN      -</div><div class="line">tcp6       0      0 ::1:9999                :::*                    LISTEN      -</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æœ¬åœ°9000ï¼ˆæˆ‘ç”¨çš„<a href="https://www.playframework.com/documentation/1.3.x/home" target="_blank" rel="external">play 1</a>ï¼Œå¯ä»¥äº†è§£ä¸‹å®ƒåˆ°åº•ä¸ºå•¥è¿™ä¹ˆå¥½ç”¨<a href="http://segmentfault.com/a/1190000000374033" target="_blank" rel="external">Play Framework â€”â€” Javaå¼€å‘è€…çš„æ¢¦æƒ³æ¡†æ¶</a>ï¼‰ä¸Šå¼€å¯webæœåŠ¡</p>
</li>
<li><p>åœ¨æµè§ˆå™¨é‡Œè¾“å…¥<a href="http://myserver_ip_address:9999ï¼Œ" target="_blank" rel="external">http://myserver_ip_address:9999ï¼Œ</a> å±…ç„¶æ˜¯æ²¡æœ‰å“åº”ï¼å¥‡æ€ªï¼ç›´æ¥åœ¨serverä¸Šç”¨curl <a href="http://localhost:9999" target="_blank" rel="external">http://localhost:9999</a> æ˜¯å¯ä»¥çš„ï¼ä»”ç»†çœ‹netstatè¾“å‡ºï¼Œå‘ç°ç›‘å¬çš„9999ç«¯å£æ˜¯æœ¬åœ°çš„ï¼ï¼ï¼ä¹Ÿå°±æ˜¯è¯´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ï¼Œé‚£æœ‰xxç”¨å•Šï¼ï¼ï¼</p>
</li>
<li><p>çœ‹çœ‹ssh â€“helpï¼Œ åŸæ¥æ˜¯å¯ä»¥æŒ‡å®šbind_addressçš„ï¼Œ man sshçœ‹çœ‹</p>
<blockquote>
<p>By default, the listening socket on the server will be bound to the loopback interface only.  This may be overridden by specifying a bind_address. An empty bind_address, or the address â€˜*â€™, indicates that the remote socket should listen on all interfaces.  Specifying a remote bind_address will only succeed if the serverâ€™s GatewayPorts option is enabled (see sshd_config(5)).</p>
</blockquote>
<p>ç»§ç»­çœ‹çœ‹ man sshd_config</p>
<blockquote>
<p>GatewayPorts<br>Specifies whether remote hosts are allowed to connect to ports forwarded for the client.  By default, sshd(8) binds remote port forwardings to the<br>loopback address.  This prevents other remote hosts from connecting to forwarded ports.  GatewayPorts can be used to specify that sshd should allow<br> remote port forwardings to bind to non-loopback addresses, thus allowing other hosts to connect.  The argument may be â€œnoâ€ to force remote port<br> forwardings to be available to the local host only, â€œyesâ€ to force remote port forwardings to bind to the wildcard address, or â€œclientspecifiedâ€ to<br> allow the client to select the address to which the forwarding is bound.  The default is â€œnoâ€.</p>
</blockquote>
<p>sudo vim /etc/ssh/sshd_configï¼Œæ·»åŠ GatewayPorts clientspecifiedï¼ŒGatewayPorts yesä¹Ÿå¯ä»¥ï¼Œé€€å‡ºï¼Œsudo service sshd restartï¼Œé‡å¯sshæœåŠ¡ã€‚é‡æ–°ssh -R :9999:localhost:9000 ubuntu@myserver_ip_addressï¼ˆä»”ç»†çœ‹ï¼Œå°±9999å‰å¤šäº†ä¸€ä¸ªå†’å·:ï¼‰ï¼Œè¾“å…¥å¯†ç ï¼Œnetstat -anltp | grep 9999ï¼Œæœç„¶</p>
 <figure class="highlight css"><table><tr><td class="code"><pre><div class="line"><span class="selector-tag">tcp</span>        0      0 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-pseudo">:9999</span>            0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span>:*               <span class="selector-tag">LISTEN</span>      <span class="selector-tag">-</span></div><div class="line"><span class="selector-tag">tcp6</span>       0      0 :<span class="selector-pseudo">::9999</span>                 :::*                    <span class="selector-tag">LISTEN</span>      <span class="selector-tag">-</span></div></pre></td></tr></table></figure>
<p> æµè§ˆå™¨é‡Œè¾“å…¥<a href="http://myserver_ip_address:9999ï¼Œ" target="_blank" rel="external">http://myserver_ip_address:9999ï¼Œ</a> è¿™å›å¯ä»¥çœ‹åˆ°æœ¬åœ°æ‰“å‡ºæ—¥å¿—äº†ã€‚</p>
</li>
<li><p>ç„¶åå‘ç°å¾®ä¿¡é‡Œé¢é…ç½®çš„urlåªèƒ½æ˜¯80ç«¯å£ã€‚ç®€å•ï¼Œç›´æ¥æ”¹æˆssh -R :80:localhost:9000 ubuntu@myserver_ip_addresså°±å¯ä»¥äº†ï¼Œå§ï¼å¥‡æ€ªï¼Œç›´æ¥è®¿é—®<a href="http://myserver_ip_addressï¼Œ" target="_blank" rel="external">http://myserver_ip_addressï¼Œ</a> æ‰“ä¸å¼€ç½‘é¡µï¼ç”¨netstat -anltp | grep 80ï¼Œå±…ç„¶ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼è¯´æ˜serveræ²¡æœ‰åœ¨80ç«¯å£ç›‘å¬å‘€ï¼å“¦ï¼Œå¯¹äº†ubuntuä½äº1024çš„ç«¯å£æ˜¯éœ€è¦ç”¨rootæƒé™çš„ã€‚</p>
</li>
<li><p>ubuntué‡Œrooté»˜è®¤æ˜¯å…³é—­çš„ã€‚sudo passwd rootï¼Œè®¾ç½®rootå¯†ç åï¼Œå¯ä»¥æ‰“å¼€ã€‚è¿˜éœ€è¦åœ¨sudo vim /etc/ssh/sshd_config    æ·»åŠ </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="comment">#PermitRootLogin without-password</span></div><div class="line"><span class="attribute">PermitRootLogin</span> <span class="literal">yes</span></div></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯sshï¼Œå†é‡æ–°ç”¨rootè´¦å·è¿æ¥ï¼Œssh -R :80:localhost:9000 root@myserver_ip_addressï¼Œ ä¸€åˆ‡okï¼Œ<a href="http://myserver_ip_addressï¼Œ" target="_blank" rel="external">http://myserver_ip_addressï¼Œ</a> æœ¬åœ°ä»£ç æ‰“å‡ºæ—¥å¿—ï¼Œè¯´æ˜æµé‡å·²ç»å¯¼å…¥åˆ°æœ¬åœ°äº†ã€‚</p>
</li>
<li>æœ€åï¼Œå°±å¯ä»¥åœ¨<a href="http://mp.weixin.qq.com/debug" target="_blank" rel="external">å¾®ä¿¡å…¬ä¼—å¹³å°æ¥å£è°ƒè¯•å·¥å…·</a>é‡Œè°ƒè¯•äº†ï¼Œé…åˆ<a href="http://playframework.com/" target="_blank" rel="external">Play!</a>çš„hot reloadï¼Œéšæ—¶ä¿®æ”¹ä»£ç ï¼ŒåŠ logï¼Œç„¶åé©¬ä¸Šå°±å¯ä»¥çœ‹åˆ°æ•ˆæœï¼Œä¸ç”¨é‡æ–°ç¼–è¯‘ï¼Œä¸ç”¨ä¸Šä¼ serverï¼Œä¸ç”¨é‡å¯ã€‚ã€‚ã€‚ã€‚ç”Ÿæ´»çœŸæ˜¯å¹¸ç¦ç¾æ»¡å•Šã€‚ã€‚ã€‚ã€‚</li>
<li>å‡ ä¸ªé—®é¢˜è¯´æ˜ï¼š<ol>
<li>ç›´æ¥ç”¨sshè¿æ¥çš„è¯ï¼Œæ–­å¼€ä¹‹åç«¯å£æ˜ å°„å°±æ²¡æœ‰äº†ï¼Œå¯ä»¥ç”¨autosshï¼Œ åªæ˜¯æˆ‘å°±æ˜¯ä¸´æ—¶éœ€è¦è°ƒè¯•ç”¨çš„æ—¶å€™æ‰sshå»ºç«‹åå‘éš§é“ï¼Œæ‰€ä»¥æˆ‘ä¸ç”¨autosshã€‚</li>
<li>ç›´æ¥ç”¨rootç™»é™†sshï¼Œå¼€é€š80ç«¯å£ã€‚åº”è¯¥æ˜¯æœ‰å®‰å…¨éšæ‚£çš„ï¼Œ å§ï¼å¯¹å®‰å…¨ä¸æ˜¯å¾ˆäº†è§£ï¼Œä½†æ„Ÿè§‰ç›´æ¥ç”¨rootè‚¯å®šä¸æ˜¯æœ€ä½³å®è·µã€‚ç½‘ä¸Šæœ‰å„ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ç”¨iptablesç«¯å£æ˜ å°„ï¼Œæˆ–è€…nginxåå‘ä»£ç†çš„ï¼Œ<a href="http://stackoverflow.com/questions/23281895/node-js-eacces-error-when-listening-on-http-80-port-permission-denied" target="_blank" rel="external">çœ‹è¿™é‡Œ</a>ï¼Œå‚çœ‹1çš„åŸå› ï¼Œæˆ‘æ²¡æœ‰é‡‡ç”¨ã€‚è¿˜æ˜¯ä¸€æ¬¡focusä¸€ä¸ªç‚¹å§ï¼Œä¸ç„¶å…‰ç¯å¢ƒå°±é…ç½®å‡ å¤©ï¼Œæœ‰ç‚¹å¤ªæ…¢äº†ã€‚</li>
</ol>
</li>
</ol>
<p>é€šè¿‡æœ¬æ–‡çš„é…ç½®ï¼Œå¯ä»¥åœ¨æœ¬åœ°æ–¹ä¾¿çš„å¼€å‘è°ƒè¯•å¾®ä¿¡å…¬å…±å·äº†ã€‚ä½†æ˜¯å¯¹äºå¾®ä¿¡æä¾›çš„<a href="http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html" target="_blank" rel="external">JS-SDK</a>ï¼Œåˆå­˜åœ¨å¦å¤–çš„é—®é¢˜ï¼Œè¿™ä¸ªæˆ‘ä¼š<a href="http://my.oschina.net/magicly007/blog/480704" target="_blank" rel="external">å¦å¤–å†™ä¸€ç¯‡blogæ¥è§£å†³</a>ã€‚æ¯•ç«Ÿï¼Œæˆ‘ä»¬ç¨‹åºå‘˜åº”è¯¥åšæŒ<a href="https://en.wikipedia.org/wiki/Single_responsibility_principle" target="_blank" rel="external">Single responsibility principle</a>å˜›ã€‚</p>
<p>Refs</p>
<ol>
<li><a href="http://www.mbnow.tk/2014/12/05/ngrok/" target="_blank" rel="external">http://www.mbnow.tk/2014/12/05/ngrok/</a></li>
<li><a href="http://my.oschina.net/jfinal/blog/336861" target="_blank" rel="external">http://my.oschina.net/jfinal/blog/336861</a></li>
<li><a href="http://www.mbnow.tk/2014/12/05/ngrok/" target="_blank" rel="external">http://www.mbnow.tk/2014/12/05/ngrok/</a></li>
<li><a href="http://liyaodong.com/2015/07/06/%E5%BE%AE%E4%BF%A1%E8%B0%83%E8%AF%95%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/" target="_blank" rel="external">http://liyaodong.com/2015/07/06/%E5%BE%AE%E4%BF%A1%E8%B0%83%E8%AF%95%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/</a></li>
<li><a href="http://my.oschina.net/abcfy2/blog/177094" target="_blank" rel="external">http://my.oschina.net/abcfy2/blog/177094</a></li>
<li><a href="http://www.zhihu.com/question/25456655" target="_blank" rel="external">http://www.zhihu.com/question/25456655</a></li>
<li>. <a href="http://my.oschina.net/atanl/blog/391611" target="_blank" rel="external">http://my.oschina.net/atanl/blog/391611</a></li>
</ol>
<blockquote>
<p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¾®ä¿¡å…¬å…±å·ç°åœ¨å¾ˆç«ï¼Œä¸€äº›ç®€å•çš„åº”ç”¨ï¼Œåšä¸€ä¸ªå…¬å…±å·æ¯”å¼€å‘ä¸€æ¬¾appæˆæœ¬è¦å°å¾ˆå¤šï¼Œè€Œä¸”åˆ©ç”¨æœ‹å‹åœˆçš„è½¬å‘ï¼Œç›¸æ¯”appå»app storeé‡Œä¸Šæ¶ç­‰ç€ç”¨æˆ·ä¸‹è½½ï¼Œè¦å®¹æ˜“å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¾®ä¿¡å…¬å…±å·çš„è°ƒè¯•æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œå¿…é¡»åœ¨å¾®ä¿¡&lt;a href=&quot;https://mp.weixin.qq.com/&quot;&gt;ç®¡ç†åå°&lt;/a&gt;é…ç½®ä¸€ä¸ªå¾®ä¿¡èƒ½è®¿é—®åˆ°ï¼ˆå…¬ç½‘ï¼‰çš„urlï¼Œç„¶ååœ¨å…¬å…±å·é‡Œè¾“å…¥å†…å®¹ï¼Œå¾®ä¿¡ä»¥xmlæ ¼å¼è½¬å‘ç»™è¿™ä¸ªurlï¼Œurlå›å¤ä¹‹åå¾®ä¿¡å†å°†responseå›å¤ç»™ä½¿ç”¨å…¬å…±å·çš„å¾®ä¿¡ç”¨æˆ·ã€‚å½“ç„¶å¾®ä¿¡ä¹Ÿæä¾›äº†&lt;a href=&quot;http://mp.weixin.qq.com/debug&quot;&gt;è°ƒè¯•å·¥å…·&lt;/a&gt;ï¼Œ å¯ä»¥ç›´æ¥æ„é€ æ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•å„ä¸ªæ¥å£ã€‚ ä½†æ˜¯ä¾ç„¶éœ€è¦ä¸€ä¸ªå…¬ç½‘çš„urlä½œä¸ºæ¥å£ã€‚äºæ˜¯æœ€åŸå§‹çš„å¼€å‘æ–¹å¼å°±æ˜¯ï¼Œä¿®æ”¹ä»£ç ï¼Œä¸Šä¼ åˆ°serverï¼Œï¼ˆå¦‚æœæ˜¯æœ‰äº›é™æ€è¯­è¨€è¿˜éœ€è¦é‡å¯æœåŠ¡å™¨ï¼‰ï¼Œç„¶åçœ‹æ˜¯å¦æ­£å¸¸workï¼Œå¦‚æœä¸è¡Œçš„è¯ï¼Œåœ¨å¯èƒ½é”™è¯¯çš„åœ°æ–¹æ‰“å‡ºlogï¼Œç„¶ååˆæ˜¯ä¿®æ”¹ä»£ç ï¼Œä¸Šä¼ serverï¼Œé‡å¯ã€‚ã€‚ã€‚ã€‚ã€‚å°±è¿™æ ·ï¼Œæ¯æ¬¡æ”¹ä¸€ç‚¹ç‚¹ï¼Œä½ éƒ½å¯ä»¥æ³¡æ¯å’–å•¡äº†ï¼Œè€æ¿å°±ä¼šè§‰å¾—ä½ å¾ˆé—²ã€‚å‚çœ‹&lt;a href=&quot;http://www.oschina.net/news/15579/reasons-why-people-who-work-with-computers-seem-to&quot;&gt;ä¸ºä»€ä¹ˆæè®¡ç®—æœºå·¥ä½œçš„äººæ€»æ˜¯çœ‹ä¸Šå»å¾ˆæ¸…é—²&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="weixin" scheme="http://magicly.me/categories/weixin/"/>
    
    
      <category term="ssh" scheme="http://magicly.me/tags/ssh/"/>
    
      <category term="weixin" scheme="http://magicly.me/tags/weixin/"/>
    
      <category term="å¾®ä¿¡" scheme="http://magicly.me/tags/%E5%BE%AE%E4%BF%A1/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„ç¬¬ä¸€ä¸ªhexo Blog</title>
    <link href="http://magicly.me/2015/07/26/my-first-hexo-blog/"/>
    <id>http://magicly.me/2015/07/26/my-first-hexo-blog/</id>
    <published>2015-07-26T03:09:45.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¼•ç”¨<a href="http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html" target="_blank" rel="external">é˜®è€å¸ˆ</a>çš„è¯ï¼Œ</p>
<blockquote>
<p>å–œæ¬¢å†™Blogçš„äººï¼Œä¼šç»å†ä¸‰ä¸ªé˜¶æ®µã€‚</p>
<pre><code>ç¬¬ä¸€é˜¶æ®µï¼Œåˆšæ¥è§¦Blogï¼Œè§‰å¾—å¾ˆæ–°é²œï¼Œè¯•ç€é€‰æ‹©ä¸€ä¸ªå…è´¹ç©ºé—´æ¥å†™ã€‚
ç¬¬äºŒé˜¶æ®µï¼Œå‘ç°å…è´¹ç©ºé—´é™åˆ¶å¤ªå¤šï¼Œå°±è‡ªå·±è´­ä¹°åŸŸåå’Œç©ºé—´ï¼Œæ­å»ºç‹¬ç«‹åšå®¢ã€‚
ç¬¬ä¸‰é˜¶æ®µï¼Œè§‰å¾—ç‹¬ç«‹åšå®¢çš„ç®¡ç†å¤ªéº»çƒ¦ï¼Œæœ€å¥½åœ¨ä¿ç•™æ§åˆ¶æƒçš„å‰æä¸‹ï¼Œè®©åˆ«äººæ¥ç®¡ï¼Œè‡ªå·±åªè´Ÿè´£å†™æ–‡ç« ã€‚
</code></pre></blockquote>
<p>è‡ªå·±æ¯”è¾ƒæ‡’æƒ°ï¼Œä¹Ÿå°±å¶å°”åœ¨<a href="http://my.oschina.net/magicly007/blog" target="_blank" rel="external">OC</a>ä¸Šå†™ç‚¹é—²æ•£çš„ç¬”è®°ï¼Œæœ€è¿‘è§‰å¾—è¿˜æ˜¯åº”è¯¥è¦æŠŠè‡ªå·±çš„çŸ¥è¯†ç³»ç»Ÿåœ°æ¢³ç†ä¸€ä¸‹ï¼Œä¾¿å†³å®šå¼€ä¸€ä¸ªç‹¬ç«‹çš„åŸŸåï¼Œè‡ªå·±è®°å½•Blogã€‚</p>
<p>ä¹‹å‰å°±äº†è§£Github Pagesï¼Œä¹Ÿæ–­æ–­ç»­ç»­ç”¨MarkDownå†™è¿‡å‡ ç¯‡æ”¾ç€ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨<a href="http://jekyllrb.com/" target="_blank" rel="external">jekyll</a>ï¼Œæˆ–è€…<a href="http://octopress.org/" target="_blank" rel="external">octpress</a>ç­‰ä¸²èµ·æ¥ï¼Œä¸Šä¸ªæœˆå†æ¬¡æƒ³é…ç½®å¥½jekyllï¼Œç»“æœåœ¨macä¸‹å§‹ç»ˆé…ç½®ä¸å¥½ï¼ˆæ€ªæˆ‘å’¯ï¼‰ã€‚ä»Šå¤©å†³å®šä¸€å®šè¦é…ç½®å¥½ï¼Œæœé›†äº†å¤§é‡èµ„æ–™ï¼ˆgoogle â€œjekyll åƒé»‘å®¢ä¸€æ ·â€ï¼‰ï¼Œç»“æœæ„å¤–åœ¨<a href="http://www.douban.com/group/topic/39939196/" target="_blank" rel="external">http://www.douban.com/group/topic/39939196/</a>çš„å›å¤ä¸­çœ‹åˆ°â€œç”¨pelicanå§ pythonçš„ è¿˜æœ‰hexoæ˜¯nodejsçš„ â€ã€‚å› ä¸ºæœ€è¿‘åˆšå¥½åœ¨çœ‹nodejsï¼Œè§‰å¾—å¾ˆæœ‰å…´è¶£ï¼Œäºæ˜¯æ”¹ä¸ºå°è¯•<a href="https://hexo.io/zh-cn/" target="_blank" rel="external">hexo</a>ã€‚</p>
<a id="more"></a>
<p>#ç®€ä»‹</p>
<p><a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="external">http://ibruce.info/2013/11/22/hexo-your-blog/</a></p>
<blockquote>
<p>hexoå‡ºè‡ªå°æ¹¾å¤§å­¦ç”Ÿ<a href="https://twitter.com/tommy351" target="_blank" rel="external">tommy351</a>ä¹‹æ‰‹ï¼Œæ˜¯ä¸€ä¸ªåŸºäº<a href="https://nodejs.org/" target="_blank" rel="external">Node.js</a>çš„é™æ€åšå®¢ç¨‹åºï¼Œå…¶ç¼–è¯‘ä¸Šç™¾ç¯‡æ–‡å­—åªéœ€è¦å‡ ç§’ã€‚hexoç”Ÿæˆçš„é™æ€ç½‘é¡µå¯ä»¥ç›´æ¥æ”¾åˆ°GitHub Pagesï¼ŒBAEï¼ŒSAEç­‰å¹³å°ä¸Šã€‚å…ˆçœ‹çœ‹tommyæ˜¯å¦‚ä½•åæ§½Octopressçš„ â†’ï¼¿â†’ <a href="http://zespia.tw/blog/2012/10/11/hexo-debut/" target="_blank" rel="external">Hexoé¢¯çˆ½ç™»å ´</a>ã€‚</p>
</blockquote>
<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é¦–å…ˆå®‰è£…Node.jsï¼Œç„¶åè¿è¡Œ<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">npm install -g hexo-cli</div><div class="line">npm install hexo --save</div></pre></td></tr></table></figure></p>
<h1 id="åˆå§‹åŒ–é…ç½®"><a href="#åˆå§‹åŒ–é…ç½®" class="headerlink" title="åˆå§‹åŒ–é…ç½®"></a>åˆå§‹åŒ–é…ç½®</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">hexo init</div><div class="line">npm install</div></pre></td></tr></table></figure>
<h1 id="å†™blog"><a href="#å†™blog" class="headerlink" title="å†™blog"></a>å†™blog</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">hexo n</div></pre></td></tr></table></figure>
<h1 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">hexo g</div></pre></td></tr></table></figure>
<h1 id="æœ¬åœ°é¢„è§ˆ"><a href="#æœ¬åœ°é¢„è§ˆ" class="headerlink" title="æœ¬åœ°é¢„è§ˆ"></a>æœ¬åœ°é¢„è§ˆ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">hexo s</div></pre></td></tr></table></figure>
<h1 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">hexo d</div></pre></td></tr></table></figure>
<p>å®åœ¨è§‰å¾—æ²¡å¿…<a href="https://en.wikipedia.org/wiki/Reinventing_the_wheel" target="_blank" rel="external">é‡å¤é€ è½®å­</a>ï¼Œé‡å†™å·²ç»æœ‰å¾ˆè¯¦ç»†èµ„æ–™çš„ä¸œè¥¿ã€‚å¼ºçƒˆæ¨è<a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="external">è¿™ç¯‡</a>ã€‚ æˆ‘è§‰å¾—åŸºæœ¬æ¶µç›–äº†æ–¹æ–¹é¢é¢ï¼Œå¦‚æœä»¥åæœ‰æ–°ä¸œè¥¿è¿™é‡Œé¢æ²¡æœ‰çš„ï¼Œæˆ‘å†å†™å§~</p>
<p>Refs</p>
<ol>
<li><a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="external">http://ibruce.info/2013/11/22/hexo-your-blog/</a></li>
<li><a href="http://wsgzao.github.io/post/hexo-guide/" target="_blank" rel="external">http://wsgzao.github.io/post/hexo-guide/</a></li>
<li><a href="http://www.jianshu.com/p/05289a4bc8b2" target="_blank" rel="external">http://www.jianshu.com/p/05289a4bc8b2</a></li>
<li><a href="http://yangjian.me/workspace/building-blog-with-hexo/" target="_blank" rel="external">http://yangjian.me/workspace/building-blog-with-hexo/</a></li>
<li><a href="http://yangjian.me/workspace/building-blog-with-hexo/" target="_blank" rel="external">http://yangjian.me/workspace/building-blog-with-hexo/</a></li>
<li><a href="http://blog.csdn.net/jackystudio/article/details/16117585" target="_blank" rel="external">http://blog.csdn.net/jackystudio/article/details/16117585</a></li>
</ol>
<blockquote>
<p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¼•ç”¨&lt;a href=&quot;http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html&quot;&gt;é˜®è€å¸ˆ&lt;/a&gt;çš„è¯ï¼Œ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å–œæ¬¢å†™Blogçš„äººï¼Œä¼šç»å†ä¸‰ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ç¬¬ä¸€é˜¶æ®µï¼Œåˆšæ¥è§¦Blogï¼Œè§‰å¾—å¾ˆæ–°é²œï¼Œè¯•ç€é€‰æ‹©ä¸€ä¸ªå…è´¹ç©ºé—´æ¥å†™ã€‚
ç¬¬äºŒé˜¶æ®µï¼Œå‘ç°å…è´¹ç©ºé—´é™åˆ¶å¤ªå¤šï¼Œå°±è‡ªå·±è´­ä¹°åŸŸåå’Œç©ºé—´ï¼Œæ­å»ºç‹¬ç«‹åšå®¢ã€‚
ç¬¬ä¸‰é˜¶æ®µï¼Œè§‰å¾—ç‹¬ç«‹åšå®¢çš„ç®¡ç†å¤ªéº»çƒ¦ï¼Œæœ€å¥½åœ¨ä¿ç•™æ§åˆ¶æƒçš„å‰æä¸‹ï¼Œè®©åˆ«äººæ¥ç®¡ï¼Œè‡ªå·±åªè´Ÿè´£å†™æ–‡ç« ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;p&gt;è‡ªå·±æ¯”è¾ƒæ‡’æƒ°ï¼Œä¹Ÿå°±å¶å°”åœ¨&lt;a href=&quot;http://my.oschina.net/magicly007/blog&quot;&gt;OC&lt;/a&gt;ä¸Šå†™ç‚¹é—²æ•£çš„ç¬”è®°ï¼Œæœ€è¿‘è§‰å¾—è¿˜æ˜¯åº”è¯¥è¦æŠŠè‡ªå·±çš„çŸ¥è¯†ç³»ç»Ÿåœ°æ¢³ç†ä¸€ä¸‹ï¼Œä¾¿å†³å®šå¼€ä¸€ä¸ªç‹¬ç«‹çš„åŸŸåï¼Œè‡ªå·±è®°å½•Blogã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰å°±äº†è§£Github Pagesï¼Œä¹Ÿæ–­æ–­ç»­ç»­ç”¨MarkDownå†™è¿‡å‡ ç¯‡æ”¾ç€ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨&lt;a href=&quot;http://jekyllrb.com/&quot;&gt;jekyll&lt;/a&gt;ï¼Œæˆ–è€…&lt;a href=&quot;http://octopress.org/&quot;&gt;octpress&lt;/a&gt;ç­‰ä¸²èµ·æ¥ï¼Œä¸Šä¸ªæœˆå†æ¬¡æƒ³é…ç½®å¥½jekyllï¼Œç»“æœåœ¨macä¸‹å§‹ç»ˆé…ç½®ä¸å¥½ï¼ˆæ€ªæˆ‘å’¯ï¼‰ã€‚ä»Šå¤©å†³å®šä¸€å®šè¦é…ç½®å¥½ï¼Œæœé›†äº†å¤§é‡èµ„æ–™ï¼ˆgoogle â€œjekyll åƒé»‘å®¢ä¸€æ ·â€ï¼‰ï¼Œç»“æœæ„å¤–åœ¨&lt;a href=&quot;http://www.douban.com/group/topic/39939196/&quot;&gt;http://www.douban.com/group/topic/39939196/&lt;/a&gt;çš„å›å¤ä¸­çœ‹åˆ°â€œç”¨pelicanå§ pythonçš„ è¿˜æœ‰hexoæ˜¯nodejsçš„ â€ã€‚å› ä¸ºæœ€è¿‘åˆšå¥½åœ¨çœ‹nodejsï¼Œè§‰å¾—å¾ˆæœ‰å…´è¶£ï¼Œäºæ˜¯æ”¹ä¸ºå°è¯•&lt;a href=&quot;https://hexo.io/zh-cn/&quot;&gt;hexo&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="default" scheme="http://magicly.me/categories/default/"/>
    
    
      <category term="github" scheme="http://magicly.me/tags/github/"/>
    
      <category term="hexo" scheme="http://magicly.me/tags/hexo/"/>
    
      <category term="githubPages" scheme="http://magicly.me/tags/githubPages/"/>
    
  </entry>
  
  <entry>
    <title>Javaå‘é€é‚®ä»¶</title>
    <link href="http://magicly.me/2015/07/13/java-email/"/>
    <id>http://magicly.me/2015/07/13/java-email/</id>
    <published>2015-07-13T13:34:10.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>éœ€è¦åœ¨ä»£ç é‡Œé¢å‘é‚®ä»¶æ˜¯å¾ˆç»å¸¸çš„äº‹æƒ…ï¼ŒåŒ…æ‹¬æ‰¾å›å¯†ç ï¼Œé€šçŸ¥ç”¨æˆ·é¢†å¥–ï¼Œç›‘æ§æŠ¥è­¦ç­‰ã€‚</p>
<p>åœ¨Javaé‡Œé¢å®ç°æ¯”è¾ƒç®€å•ï¼ŒOracleè‡ªå·±æä¾›äº†<a href="http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-eeplat-419426.html#javamail-1.4.7-oth-JPR" target="_blank" rel="external">JavaMail</a>ï¼Œ ä¸è¿‡APIæ¯”è¾ƒåº•å±‚ï¼Œç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œå¯ä»¥è‡ªå·±å°è£…ä¸‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Apacheçš„å¼€æºé¡¹ç›®<a href="https://commons.apache.org/proper/commons-email/" target="_blank" rel="external">Commons Email</a>ã€‚ ä¸‹é¢çš„ä»£ç ï¼Œå¯ä»¥ä»¥å°é©¬å“¥çš„åä¹‰ç»™è‡ªå·±å‘é‚®ä»¶ï¼Œè¯¥åŠŸèƒ½ä»…ç”¨äºæµ‹è¯•ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼Œäº§ç”Ÿçš„é—®é¢˜ï¼Œæœ¬äººæ¦‚ä¸è´Ÿè´£ã€‚ /å¾®ç¬‘</p>
<a id="more"></a>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><div class="line"><span class="meta"><span class="meta-keyword">import</span> org.apache.commons.mail.EmailAttachment;</span></div><div class="line"><span class="meta"><span class="meta-keyword">import</span> org.apache.commons.mail.EmailException;</span></div><div class="line"><span class="meta"><span class="meta-keyword">import</span> org.apache.commons.mail.MultiPartEmail;</span></div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">import</span> java.net.MalformedURLException;</span></div><div class="line"><span class="meta"><span class="meta-keyword">import</span> java.net.URL;</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by magicalli on 2015/7/6.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiPartEmailTest</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) throws EmailException, MalformedURLException &#123;</div><div class="line">        MultiPartEmail email = <span class="keyword">new</span> MultiPartEmail();</div><div class="line"></div><div class="line">        email.setHostName(<span class="string">"smtp.tencent.com"</span>);</div><div class="line"><span class="comment">//        email.setAuthentication("youremail@tencent.com", "***");//é‚®ä»¶æœåŠ¡å™¨éªŒè¯ï¼šç”¨æˆ·å/å¯†ç </span></div><div class="line">        email.setCharset(<span class="string">"UTF-8"</span>);</div><div class="line"></div><div class="line">        email.setFrom(<span class="string">"pony@qq.com"</span>, <span class="string">"é©¬åŒ–è…¾"</span>);</div><div class="line">        email.addTo(<span class="string">"magicalli@tencent.com"</span>);</div><div class="line"></div><div class="line">        email.setSubject(<span class="string">"åŠ æ²¹å¥‹æ–—ï¼"</span>);</div><div class="line">        email.setMsg(<span class="string">"come on! åŠ æ²¹å¥‹æ–—å§ï¼Œæ—©æ™šæœ‰ä¸€å¤©ä½ ä¼šå‡ºä»»CEOï¼Œè¿å¨¶ç™½å¯Œç¾ï¼Œèµ°ä¸Šäººç”Ÿå·…å³°ï¼ http://www.qq.com\n\n\n pony"</span>);</div><div class="line"></div><div class="line">        EmailAttachment attachment = <span class="keyword">new</span> EmailAttachment();</div><div class="line">        attachment.setPath(<span class="string">"d:/lzl.jpg"</span>);<span class="comment">// æœ¬åœ°æ–‡ä»¶</span></div><div class="line">        attachment.setDisposition(EmailAttachment.ATTACHMENT);</div><div class="line">        attachment.setDescription(<span class="string">"æ—å¿—ç²1"</span>);</div><div class="line">        attachment.setName(<span class="string">"lzl_1"</span>);</div><div class="line">        email.attach(attachment);</div><div class="line"></div><div class="line">        EmailAttachment attachment2 = <span class="keyword">new</span> EmailAttachment();</div><div class="line">        attachment2.setURL(<span class="keyword">new</span> URL(<span class="string">"http://mat1.qq.com/datalib_img/star/pic/lib/2007-01-15/2007011511104716122311.jpg"</span>));<span class="comment">//è¿œç¨‹æ–‡ä»¶, å¦‚æœä¸æ˜¯qq.comåŸŸåä¸‹ï¼Œå†…ç½‘æ˜¯è®¿é—®ä¸äº†çš„å“ˆ</span></div><div class="line">        attachment2.setDisposition(EmailAttachment.ATTACHMENT);</div><div class="line">        attachment2.setDescription(<span class="string">"æ—å¿—ç²2"</span>);</div><div class="line">        attachment2.setName(<span class="string">"lzl_2"</span>);</div><div class="line">        email.attach(attachment2);</div><div class="line"></div><div class="line">        email.send();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://commons.apache.org/proper/commons-email/" target="_blank" rel="external">Commons Email</a>æ”¯æŒå¥½å‡ ç§æ ¼å¼ï¼ŒåŒ…æ‹¬ç®€å•æ–‡æœ¬ï¼Œhtmlï¼Œå¸¦é™„ä»¶ç­‰ã€‚éœ€è¦çš„å¯ä»¥è‡ªå·±æŸ¥çœ‹æ–‡æ¡£ã€‚</p>
<p>åŸºäºsmtpçš„åè®®é‚®ä»¶åè®®å¾ˆç®€å•ï¼Œå¤§å®¶ç”šè‡³å¯ä»¥ç›´æ¥ç”¨telnetæ¥å‘é€ï¼Œå¯ä»¥å‚è€ƒè¿™è¾¹æ–‡ç« <a href="http://blog.csdn.net/ghsau/article/details/8602076" target="_blank" rel="external">Java Mail(ä¸€)ï¼štelnetå®ç°å‘é€æ”¶å–é‚®ä»¶</a>. </p>
<p>ä¸€èˆ¬å…¬å¸å†…ç½‘æ²¡æœ‰éªŒè¯å‘é€æ–¹ï¼Œä½ å¯ä»¥å†’å……å…¬å¸ä»»ä½•ä¸€ä¸ªå‘˜å·¥å‘é€é‚®ä»¶ï¼ˆåŒ…æ‹¬ä½ ä»¬è€æ¿ï¼‰ï¼Œä¸€èˆ¬å¤–é¢çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œæ¯”å¦‚qq, 126, 163ç­‰ï¼Œæ˜¯éœ€è¦éªŒè¯å¯†ç çš„ã€‚</p>
<p>é‡ç”³ä¸€éï¼Œåˆ«ç”¨è¿™ä¸ªä»£ç å¹²åäº‹ï¼Œåæœè‡ªè´Ÿï¼Œ ä¸æœ¬äººæ— å…³ï¼</p>
<p>Refs</p>
<ol>
<li><a href="http://blog.csdn.net/ghsau/article/details/8602076" target="_blank" rel="external">http://blog.csdn.net/ghsau/article/details/8602076</a></li>
<li><a href="http://blog.csdn.net/ghsau/article/details/17839983" target="_blank" rel="external">http://blog.csdn.net/ghsau/article/details/17839983</a></li>
<li><a href="http://haolloyin.blog.51cto.com/1177454/354320" target="_blank" rel="external">http://haolloyin.blog.51cto.com/1177454/354320</a></li>
<li><a href="http://www.runoob.com/java/java-sending-email.html" target="_blank" rel="external">http://www.runoob.com/java/java-sending-email.html</a></li>
<li><a href="https://commons.apache.org/proper/commons-email/" target="_blank" rel="external">https://commons.apache.org/proper/commons-email/</a></li>
<li><a href="http://blog.csdn.net/qiaqia609/article/details/11580589" target="_blank" rel="external">http://blog.csdn.net/qiaqia609/article/details/11580589</a></li>
</ol>
<blockquote>
<p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      this is desc.
    
    </summary>
    
      <category term="Java" scheme="http://magicly.me/categories/Java/"/>
    
    
      <category term="Java" scheme="http://magicly.me/tags/Java/"/>
    
      <category term="Email" scheme="http://magicly.me/tags/Email/"/>
    
      <category term="JavaMail" scheme="http://magicly.me/tags/JavaMail/"/>
    
      <category term="Apache Commons" scheme="http://magicly.me/tags/Apache-Commons/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªJavaå¯¹è±¡åˆ°åº•æœ‰å¤šå¤§</title>
    <link href="http://magicly.me/2015/06/13/how-big-is-a-java-object/"/>
    <id>http://magicly.me/2015/06/13/how-big-is-a-java-object/</id>
    <published>2015-06-13T13:34:10.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç»å¸¸é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å†…å­˜é‡Œç¼“å­˜ä¸€æ‰¹æ•°æ®æ¥æé«˜æ•ˆç‡ï¼ˆé¿å…æ¯æ¬¡éƒ½è¯»å–DBï¼‰ã€‚é‚£é—®é¢˜æ¥äº†ï¼Œè¿™äº›å¯¹è±¡åˆ°åº•ä¼šå ç”¨å¤šå¤§å†…å­˜å‘¢ï¼Œè¿™ç›´æ¥å†³å®šäº†å¯ä»¥ç¼“å­˜å¤šå°‘æ¡è®°å½•ï¼Œä»¥åŠä¸Šçº¿ä¹‹åæ˜¯å¦ä¼šå†…å­˜ä¸å¤Ÿç­‰é—®é¢˜ã€‚</p>
<p>æ¥çœ‹å‡ ç§è§£å†³æ–¹æ³•ã€‚</p>
<a id="more"></a>
<p>#æµ‹è¯•</p>
<p>å®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†ï¼æ¯”å¦‚ä½ è¦æƒ³cache10wæ¡è®°å½•ï¼Œé‚£ä½ å°±æŠŠ10wæ¡è®°å½•åŠ è½½åˆ°å†…å­˜ï¼Œç„¶åçœ‹çœ‹åˆ°åº•ç”¨äº†å¤šå°‘å†…å­˜ã€‚è‡³äºæ€ä¹ˆçœ‹å†…å­˜èŠ±äº†å¤šå°‘ï¼Œä½ å¯ä»¥</p>
<ol>
<li>ä»»åŠ¡ç®¡ç†å™¨</li>
<li>top</li>
<li>Java Runtimeç±»</li>
<li>blablaã€‚ã€‚ã€‚ã€‚</li>
</ol>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ç›´æ¥ä»Javaç¨‹åºé‡Œèƒ½è·å–åˆ°çš„Runtimeã€‚</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by magicalli on 2015/2/3.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> class TestMemory &#123;</div><div class="line">    <span class="keyword">static</span> class A &#123;</div><div class="line">        <span class="built_in">int</span> a;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"--- Memory Usage ---:"</span>);</div><div class="line">        Runtime rt = Runtime.getRuntime();</div><div class="line">        <span class="comment">//æ‰“å°æ€»å†…å­˜å¤§å° //æ‰“å°ç©ºé—²å†…å­˜å¤§å° //æ‰“å°å·²ç”¨å†…å­˜å¤§å° å•ä½(å­—èŠ‚)</span></div><div class="line">        <span class="keyword">long</span> usedMemory = rt.totalMemory() - rt.freeMemory();</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Total Memory= "</span> + rt.totalMemory() + <span class="string">" Free Memory = "</span> + rt.freeMemory() + <span class="string">" Usedã€€Memory="</span> + usedMemory);</div><div class="line"></div><div class="line">        <span class="comment">// æŠŠä½ è¦æµ‹è¯•çš„å ç”¨å†…å­˜çš„ä»£ç æ”¾åœ¨è¿™é‡Œ------start--------------</span></div><div class="line">        <span class="keyword">final</span> <span class="built_in">int</span> N = <span class="number">100000</span>;</div><div class="line">        <span class="built_in">int</span>[] arr = <span class="keyword">new</span> <span class="built_in">int</span>[N];</div><div class="line">        Integer[] arr2 = <span class="keyword">new</span> Integer[N];</div><div class="line">        A[] arrA = <span class="keyword">new</span> A[N];</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">            arr[i] = i;</div><div class="line"><span class="comment">//            arr2[i] = i;</span></div><div class="line"><span class="comment">//            arrA[i] = new A();</span></div><div class="line">        &#125;</div><div class="line"><span class="comment">//        List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();</span></div><div class="line">        Map&lt;Integer, <span class="keyword">String</span>&gt; <span class="built_in">map</span> = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;Integer, <span class="keyword">String</span>&gt;();</div><div class="line"><span class="comment">//        for (int i = 0; i &lt; N; i++) &#123;</span></div><div class="line"><span class="comment">//            list.add(i);</span></div><div class="line"><span class="comment">//            map.put(i, UUID.randomUUID().toString());</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//        System.out.println(map.size());</span></div><div class="line">        <span class="comment">// æŠŠä½ è¦æµ‹è¯•çš„å ç”¨å†…å­˜çš„ä»£ç æ”¾åœ¨è¿™é‡Œ------end--------------</span></div><div class="line"></div><div class="line">        <span class="keyword">long</span> usedMemory2 = rt.totalMemory() - rt.freeMemory();</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"Total Memory= "</span> + rt.totalMemory() + <span class="string">" Free Memory = "</span> + rt.freeMemory() + <span class="string">" Usedã€€Memory="</span> + usedMemory2);</div><div class="line">        <span class="keyword">long</span> objMemory = usedMemory2 - usedMemory;</div><div class="line">        System.out.<span class="built_in">println</span>(<span class="string">"object use memory: "</span> + objMemory / <span class="number">1024</span> + <span class="string">"k"</span> + <span class="string">" each is: "</span> + objMemory / N);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢æ–¹æ³•çš„æœ€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥ç›´æ¥è·å¾—å®é™…å ç”¨å†…å­˜å¤§å°ï¼Œæ˜¯æ¯”è¾ƒç®€å•æœ‰æ•ˆçš„æ–¹æ³•ã€‚ä¸å¥½çš„åœ°æ–¹å°±æ˜¯å¦‚æœæ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¯èƒ½åå·®æ¯”è¾ƒå¤§ï¼Œè€Œä¸”ä½ ä¹Ÿä¸èƒ½è§£é‡Šä¸ºä»€ä¹ˆInteger[]æ¯”int[]å ç”¨å†…å­˜å¤§å¾ˆå¤šï¼Œå…³é”®æ˜¯ä¸“å®¶è¯´ï¼šè¿™ç§å†…å­˜å ç”¨åº”è¯¥æ˜¯å¿ƒé‡Œç®—å‡ºæ¥çš„ï¼Œä½ è¿˜è¦å»runä¸€ä¸‹ç¨‹åºï¼Œæ˜æ˜¾å°±lowäº†ï¼Œè¿˜æƒ³æ™‹çº§ï¼Ÿå†ç»ƒç»ƒå§ï¼æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆææŒ‡ä¸€ç®—ï¼</p>
<p>#è®¡ç®—</p>
<p>è¿™ä¸ªéœ€è¦äº†è§£JVMé‡Œçš„å†…å­˜åˆ†å¸ƒï¼ŒçŸ¥é“æ¯ä¸ªå¯¹è±¡éƒ½æœ‰object headerï¼Œblabalã€‚è¿™é‡Œæ¨èä¸€ç¯‡å¥½æ–‡<a href="http://www.cnblogs.com/magialmoon/p/3757767.html" target="_blank" rel="external">ä¸€ä¸ªJavaå¯¹è±¡åˆ°åº•å ç”¨å¤šå¤§å†…å­˜ï¼Ÿ</a>ï¼Œæˆ‘å°±ä¸é‡å¤äº†ã€‚</p>
<p>è¿˜çœ‹åˆ°å¦ä¸€ç§è®¡ç®—æ–¹å¼ï¼Œç”¨çš„Unsafeï¼Œä¸è¿‡æ„Ÿè§‰æ²¡æœ‰å‰é¢ç”¨Instrumentationçš„å¥½ã€‚å‚è€ƒè¿™é‡Œ<a href="http://blog.csdn.net/bobpauline/article/details/20699233" target="_blank" rel="external">Javaè®¡ç®—ä¸€ä¸ªå¯¹è±¡å ç”¨å†…å­˜çš„å¤§å°</a></p>
<p>#çº¿ä¸ŠæŸ¥çœ‹</p>
<p>å¦‚æœæ˜¯è¦æŸ¥çœ‹çº¿ä¸Šç¨‹åºå“ªä¸ªå¯¹è±¡å ç”¨äº†å¤§é‡å†…å­˜ï¼ˆæ¯”å¦‚åˆ†æå†…å­˜æ³„éœ²ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨jmapã€‚</p>
<p>#ç›¸å…³çŸ¥è¯†<br>ä½ å¯èƒ½éœ€è¦äº†è§£jpsï¼Œjinfoï¼Œæ‰“åŒ…jarï¼Œmanifestï¼ŒæŸ¥çœ‹jvmè¿è¡Œå‚æ•°ç­‰ã€‚</p>
<p>#refers</p>
<ol>
<li><a href="http://www.importnew.com/14948.html" target="_blank" rel="external">http://www.importnew.com/14948.html</a></li>
<li><a href="http://www.cnblogs.com/magialmoon/p/3757767.html" target="_blank" rel="external">http://www.cnblogs.com/magialmoon/p/3757767.html</a></li>
<li><a href="http://www.oschina.net/question/1_4486" target="_blank" rel="external">http://www.oschina.net/question/1_4486</a></li>
<li><a href="http://blog.csdn.net/bobpauline/article/details/20699233" target="_blank" rel="external">http://blog.csdn.net/bobpauline/article/details/20699233</a></li>
<li><a href="http://happyqing.iteye.com/blog/2013639" target="_blank" rel="external">http://happyqing.iteye.com/blog/2013639</a></li>
<li><a href="http://sunqi.iteye.com/blog/1917802" target="_blank" rel="external">http://sunqi.iteye.com/blog/1917802</a></li>
<li><a href="http://www.blogjava.net/stone2083/archive/2013/06/08/400410.html" target="_blank" rel="external">http://www.blogjava.net/stone2083/archive/2013/06/08/400410.html</a></li>
<li><a href="http://yueyemaitian.iteye.com/blog/2033046" target="_blank" rel="external">http://yueyemaitian.iteye.com/blog/2033046</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-instrumentation/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/java/j-lo-instrumentation/</a></li>
</ol>
<blockquote>
<p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»å¸¸é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å†…å­˜é‡Œç¼“å­˜ä¸€æ‰¹æ•°æ®æ¥æé«˜æ•ˆç‡ï¼ˆé¿å…æ¯æ¬¡éƒ½è¯»å–DBï¼‰ã€‚é‚£é—®é¢˜æ¥äº†ï¼Œè¿™äº›å¯¹è±¡åˆ°åº•ä¼šå ç”¨å¤šå¤§å†…å­˜å‘¢ï¼Œè¿™ç›´æ¥å†³å®šäº†å¯ä»¥ç¼“å­˜å¤šå°‘æ¡è®°å½•ï¼Œä»¥åŠä¸Šçº¿ä¹‹åæ˜¯å¦ä¼šå†…å­˜ä¸å¤Ÿç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ¥çœ‹å‡ ç§è§£å†³æ–¹æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://magicly.me/categories/Java/"/>
    
    
      <category term="Java" scheme="http://magicly.me/tags/Java/"/>
    
      <category term="JVM" scheme="http://magicly.me/tags/JVM/"/>
    
      <category term="Javaåå°„" scheme="http://magicly.me/tags/Java%E5%8F%8D%E5%B0%84/"/>
    
  </entry>
  
  <entry>
    <title>J.U.Cæºç è§£è¯»ä¹‹atomic</title>
    <link href="http://magicly.me/2015/01/13/juc-source-code-read-atomic/"/>
    <id>http://magicly.me/2015/01/13/juc-source-code-read-atomic/</id>
    <published>2015-01-13T13:34:10.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>java5ä¹‹åçš„java.util.concurrentåŒ…æ˜¯ä¸–ç•Œçº§å¹¶å‘å¤§å¸ˆDoug Leaçš„ä½œå“ï¼Œé‡Œé¢ä¸»è¦å®ç°äº†</p>
<ol>
<li>atomicåŒ…é‡ŒInteger/Longå¯¹åº”çš„åŸå­ç±»ï¼Œä¸»è¦åŸºäºCASï¼›</li>
<li>ä¸€äº›åŒæ­¥å­ï¼ŒåŒ…æ‹¬Lockï¼ŒCountDownLatchï¼ŒSemaphoreï¼ŒFutureTaskç­‰ï¼Œè¿™äº›éƒ½æ˜¯åŸºäºAbstractQueuedSynchronizerç±»ï¼›</li>
<li>å…³äºçº¿ç¨‹æ‰§è¡Œçš„Executorsç±»ç­‰ï¼›</li>
<li>ä¸€äº›å¹¶å‘çš„é›†åˆç±»ï¼Œæ¯”å¦‚ConcurrentHashMapï¼ŒConcurrentLinkedQueueï¼ŒCopyOnWriteArrayListç­‰ã€‚</li>
</ol>
<p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»atomicåŒ…ä¸‹ç›¸å…³å†…å®¹ã€‚</p>
<a id="more"></a>
<p>#CAS</p>
<p>atomicåŒ…ä¸‹çš„ç±»ä¸»è¦åŸºäºç°ä»£ä¸»æµ CPU éƒ½æ”¯æŒçš„ä¸€ç§æŒ‡ä»¤ï¼ŒCompare and Swapï¼ˆCASï¼‰ï¼Œè¿™ä¸ªæŒ‡ä»¤èƒ½ä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ã€‚å¼•ç”¨ã€ŠJava Concurrency in Practiceã€‹é‡Œçš„ä¸€æ®µæè¿°ï¼š</p>
<blockquote>
<p>åœ¨è¿™é‡Œï¼ŒCAS æŒ‡çš„æ˜¯ç°ä»£ CPU å¹¿æ³›æ”¯æŒçš„ä¸€ç§å¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®è¿›è¡Œæ“ä½œçš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ã€‚è¿™ä¸ªæŒ‡ä»¤ä¼šå¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®åšåŸå­çš„è¯»å†™æ“ä½œã€‚ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæŒ‡ä»¤çš„æ“ä½œè¿‡ç¨‹ï¼šé¦–å…ˆï¼ŒCPU ä¼šå°†å†…å­˜ä¸­å°†è¦è¢«æ›´æ”¹çš„æ•°æ®ä¸æœŸæœ›çš„å€¼åšæ¯”è¾ƒã€‚ç„¶åï¼Œå½“è¿™ä¸¤ä¸ªå€¼ç›¸ç­‰æ—¶ï¼ŒCPU æ‰ä¼šå°†å†…å­˜ä¸­çš„æ•°å€¼æ›¿æ¢ä¸ºæ–°çš„å€¼ã€‚å¦åˆ™ä¾¿ä¸åšæ“ä½œã€‚æœ€åï¼ŒCPU ä¼šå°†æ—§çš„æ•°å€¼è¿”å›ã€‚è¿™ä¸€ç³»åˆ—çš„æ“ä½œæ˜¯åŸå­çš„ã€‚å®ƒä»¬è™½ç„¶çœ‹ä¼¼å¤æ‚ï¼Œä½†å´æ˜¯ Java 5 å¹¶å‘æœºåˆ¶ä¼˜äºåŸæœ‰é”æœºåˆ¶çš„æ ¹æœ¬ã€‚ç®€å•æ¥è¯´ï¼ŒCAS çš„å«ä¹‰æ˜¯â€œæˆ‘è®¤ä¸ºåŸæœ‰çš„å€¼åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†åŸæœ‰çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ä¸åšä¿®æ”¹ï¼Œå¹¶å‘Šè¯‰æˆ‘åŸæ¥çš„å€¼æ˜¯å¤šå°‘â€ã€‚</p>
</blockquote>
<p>#AtomicInteger<br><figure class="highlight cs"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> <span class="keyword">value</span>;</div></pre></td></tr></table></figure></p>
<p>AtomicIntegeré‡Œé¢åªåŒ…å«ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥è®°å½•å½“å‰å€¼ï¼Œå®šä¹‰ä¸ºvolatileæ˜¯ä¸ºäº†æ»¡è¶³<strong>å¯è§æ€§</strong>ã€‚<br><figure class="highlight d"><table><tr><td class="code"><pre><div class="line"><span class="comment">// setup to use Unsafe.compareAndSwapInt for updates</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">long</span> valueOffset;</div><div class="line"></div><div class="line">  <span class="keyword">static</span> &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      valueOffset = unsafe.objectFieldOffset</div><div class="line">          (AtomicInteger.<span class="keyword">class</span>.getDeclaredField(<span class="string">"value"</span>));</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex); &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>ä¸€å¼€å§‹å®šä¹‰äº†staticå˜é‡Unsafeï¼ŒAtomicIntegeré‡Œé¢çš„æ–¹æ³•éƒ½æ˜¯å¯¹unsafeé‡Œé¢<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="function"><span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">int</span> var4, <span class="keyword">int</span> var5)</span></span>;</div></pre></td></tr></table></figure></p>
<p>æ–¹æ³•çš„å°è£…ã€‚<br>æˆ‘ä»¬æ¥çœ‹åŸå­æ€§çš„i++ï¼Œ<br><figure class="highlight gradle"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> getAndIncrement() &#123;</div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        <span class="keyword">int</span> current = get();</div><div class="line">        <span class="keyword">int</span> <span class="keyword">next</span> = current + <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (compareAndSet(current, <span class="keyword">next</span>))</div><div class="line">            <span class="keyword">return</span> current;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ä¸€ä¸ªæ— é™å¾ªç¯é‡Œé¢ï¼Œé¦–å…ˆè·å–å½“å‰å€¼ï¼Œç”¨å½“å‰å€¼+1ï¼Œç„¶åè°ƒç”¨<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">return</span> unsafe.<span class="title">compareAndSwapInt</span><span class="params">(<span class="keyword">this</span>, valueOffset, expect, update)</span></span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>unsafe.compareAndSwapInt(this, valueOffset, expect, update)çš„å«ä¹‰æ˜¯æŠŠthiså¯¹è±¡é‡Œé¢valueOffsetï¼ˆåœ¨ä¸€å¼€å§‹staticä»£ç é‡Œé¢è·å–ï¼‰è¿™ä¸ªä½ç½®ï¼ˆå³valueå€¼ï¼‰è·Ÿexpectæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™ä¿®æ”¹ä¸ºupdateï¼Œè¿”å›trueï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œè¯´æ˜åœ¨è·å–åˆ°currentä¹‹åæœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡valueçš„å€¼ï¼Œåˆ™é‡æ–°æ¥ä¸€éï¼Œä¸€ç›´åˆ°ä¿®æ”¹æˆåŠŸä¸ºæ­¢ã€‚è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æœ‰å¯èƒ½æ°¸è¿œä¸èƒ½è¿”å›çš„ï¼Œå®é™…è€Œè¨€ï¼Œå½“å¹¶å‘å†²çªå¾ˆä¸¥é‡ï¼Œåå¤compareAndSet(current, next)å¤±è´¥ï¼Œæœ‰å¯èƒ½ä¹Ÿéœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚</p>
<p>AtomicIntegeré‡Œé¢çš„å…¶ä»–æ–¹æ³•ï¼ŒåŸºæœ¬ç±»ä¼¼ï¼›å…¶ä»–ç±»åŒ…æ‹¬AtomicLongï¼ŒAtomicReferenceç­‰ä¹Ÿæ˜¯åŸºæœ¬å¯¹Unsafeé‡Œé¢compareAndSetçš„ä¸€ä¸ªå°è£…ã€‚</p>
<p>#Unsafe</p>
<p>å‰é¢å¯ä»¥çœ‹åˆ°Unsafeç±»åœ¨å®ç°atomicçš„é‡è¦æ€§ã€‚ä¸ºä»€ä¹ˆæœ‰Unsafeè¿™ä¸ªclasså‘¢ï¼ŒåŸºæœ¬åŸå› æ˜¯Javaä¸å…è®¸ä»£ç ç›´æ¥æ“ä½œå†…å­˜ï¼Œå¥½å¤„æ˜¯æ›´å®‰å…¨ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°å†…å­˜æ³„éœ²ï¼Œå› ä¸ºæœ‰JVMçš„GCï¼›åå¤„æ˜¯æœ‰äº›åº•å±‚è°ƒç”¨æ‰§è¡Œä¸äº†ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼ŒUnsafeå°±æ˜¯è¿™ä¸ªjavaå®‰å…¨å›´åŸé€šå‘æ¯”å¦‚c++è¿™ä¸ªä¸å®‰å…¨å¤–å›´çš„ä¸€é“é—¨ï¼Œæ‰€ä»¥å«Unsafeå˜›ã€‚Unsafeé‡Œé¢åŸºæœ¬éƒ½æ˜¯nativeï¼Œå³é€šè¿‡JNIè°ƒç”¨c/c++ç­‰ä»£ç ã€‚å¤§éƒ¨åˆ†æ˜¯ç›´æ¥å†…å­˜æ“ä½œï¼Œä»¥åŠåé¢ä¼šè®²åˆ°çš„æŒ‚èµ·å”¤é†’çº¿ç¨‹ç­‰ï¼ŒåŒ…æ‹¬parkå’Œunparkã€‚</p>
<p>å‰é¢åˆ°<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="function"><span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">int</span> var4, <span class="keyword">int</span> var5)</span></span>;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ–¹æ³•å°±ä¸æ˜¯javaä»£ç äº†ï¼Œå¦‚æœæƒ³çœ‹å®ç°çš„è¯ï¼Œéœ€è¦ä¸‹è½½OpenJDKæºç ï¼Œé‡Œé¢æ˜¯c++ä»£ç è°ƒç”¨æ±‡ç¼–ä»£ç ï¼Œblablaã€‚æˆ‘ä¸å»ºè®®å¤§å®¶å†å¾€ä¸‹ç»§ç»­äº†ï¼ŒåŸå› æœ‰å‡ ä¸ªï¼Œä¸€æ˜¯æˆ‘ä»¬ç”¨javaç­‰é«˜çº§è¯­è¨€çš„ç›®çš„å°±æ˜¯ä¸ºäº†é¿å…çº ç»“å¤æ‚çš„åº•å±‚ç»†èŠ‚ï¼Œç«™åœ¨æ›´é«˜å±‚çš„è§’åº¦æ€è€ƒé—®é¢˜ï¼Œè€Œä¸”javaé‡Œé¢è¿˜æœ‰æ›´å¤šçš„é—®é¢˜ç­‰å¾…ä½ å»è§£å†³ï¼Œæ›´å¤šçš„çŸ¥è¯†å¯ä»¥å­¦ä¹ å‘¢ï¼å¦‚æœä½ è¯´ä½ å·²ç»æŠŠjavaå®Œå…¨æŒæ¡äº†ï¼ŒåŒ…æ‹¬æŠŠjdkæºç ï¼Œtomcatã€springï¼Œxxxxxæºç éƒ½çœ‹è¿‡äº†ï¼Œå®åœ¨æ²¡å¾—çœ‹äº†ï¼Œé‚£æˆ‘ä¼šè¯´ï¼Œå¤šé™ªé™ªå®¶äººå§~é™¤éä½ æ˜¯JVMå¼€å‘å·¥ç¨‹å¸ˆï¼Œå“¦ï¼Œé‚£ä¸å¥½æ„æ€ï¼Œå¤§ç¥ï¼Œå½“æˆ‘å•¥éƒ½æ²¡è¯´ã€‚ã€‚ã€‚ã€‚ä¸ºäº†å®Œæ•´æ€§ï¼Œæˆ‘è´´å‡ ä¸ªå‚è€ƒé“¾æ¥<a href="http://www.blogjava.net/mstar/archive/2013/04/24/398351.html" target="_blank" rel="external">http://www.blogjava.net/mstar/archive/2013/04/24/398351.html</a>, <a href="http://zl198751.iteye.com/blog/1848575" target="_blank" rel="external">http://zl198751.iteye.com/blog/1848575</a>.</p>
<p>é‚£ä¹ˆå¦‚æœè·å–Unsafeå‘¢ï¼ŸUnsafeæœ‰ä¸€ä¸ªstaticæ–¹æ³•å¯ä»¥è·å–Unsafeå®ä¾‹ï¼Œå¦‚ä¸‹<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Unsafe <span class="title">getUnsafe</span><span class="params">()</span> </span>&#123;</div><div class="line">       Class var0 = Reflection.getCallerClass(<span class="number">2</span>);</div><div class="line">       <span class="keyword">if</span>(var0.getClassLoader() != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="string">"Unsafe"</span>);</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           <span class="keyword">return</span> theUnsafe;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>å¯æ˜¯ä½ å¦‚æœåœ¨è‡ªå·±ä»£ç é‡Œä½¿ç”¨ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯è¿è¡Œæ—¶å€™æŠ¥é”™ã€‚å› ä¸ºé‡Œé¢é™åˆ¶äº†è°ƒç”¨getUnsafe()è¿™ä¸ªæ–¹æ³•çš„ç±»å¿…é¡»æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨Bootstrap Loaderã€‚æ‰€ä»¥å¦‚æœæƒ³åœ¨è‡ªå·±ä»£ç é‡Œé¢è°ƒç”¨Unsafeçš„è¯ï¼ˆå¼ºçƒˆå»ºè®®ä¸è¦è¿™æ ·å­åšï¼‰ï¼Œå¯ä»¥ç”¨Javaçš„åå°„æ¥å®ç°ï¼š</p>
<pre><code>    static class UnsafeSupport {
        private static Unsafe unsafe;

        static {
            Field field;
            try {
                // ç”±åç¼–è¯‘Unsafeç±»è·å¾—çš„ä¿¡æ¯
                field = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;);
                field.setAccessible(true);
                // è·å–é™æ€å±æ€§,Unsafeåœ¨å¯åŠ¨JVMæ—¶éšrt.jarè£…è½½
                unsafe = (Unsafe) field.get(null);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        public static Unsafe getInstance() {
//            return Unsafe.getUnsafe();//æ²¡æœ‰ç”¨ï¼Œåªèƒ½nativeè·å–ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸
            return unsafe;
        }
    }
</code></pre><p>è·å–åˆ°äº†Unsafeçš„å®ä¾‹ä¹‹åï¼Œä½ ç…§æ ·å¯ä»¥è‡ªå·±å®ç°Atomicç±»ï¼Œå†è¯´ä¸€éï¼Œå¼ºçƒˆå»ºè®®ä¸è¦è¿™æ ·åšï¼ï¼ï¼</p>
<p>#CASä¼˜ç‚¹</p>
<p>Compare and Set æ˜¯ä¸€ä¸ªéé˜»å¡çš„ç®—æ³•ï¼Œè¿™æ˜¯å®ƒçš„ä¼˜åŠ¿ã€‚å› ä¸ºä½¿ç”¨çš„æ˜¯CPUæ”¯æŒçš„æŒ‡ä»¤ï¼Œæä¾›äº†æ¯”åŸæœ‰çš„å¹¶å‘æœºåˆ¶æ›´å¥½çš„æ€§èƒ½å’Œä¼¸ç¼©æ€§ã€‚å¯ä»¥è®¤ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æ€§èƒ½æ›´å¥½ï¼Œå¹¶ä¸”ä¹Ÿæ›´å®¹æ˜“ä½¿ç”¨ï¼ˆè¿™æ‰æ˜¯å…³é”®å•Šï¼‰ã€‚</p>
<p>#CASç¼ºç‚¹</p>
<p>##ABAé—®é¢˜</p>
<p>CASæ“ä½œå®¹æ˜“å¯¼è‡´ABAé—®é¢˜,ä¹Ÿå°±æ˜¯åœ¨åša++ä¹‹é—´ï¼Œaå¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹ä¿®æ”¹è¿‡äº†ï¼Œåªä¸è¿‡å›åˆ°äº†æœ€åˆçš„å€¼ï¼Œè¿™æ—¶CASä¼šè®¤ä¸ºaçš„å€¼æ²¡æœ‰å˜ã€‚aåœ¨å¤–é¢é€›äº†ä¸€åœˆå›æ¥ï¼Œä½ èƒ½ä¿è¯å®ƒæ²¡æœ‰åšä»»ä½•åäº‹ï¼Œä¸èƒ½ï¼ï¼ä¹Ÿè®¸å®ƒè®¨é—²ï¼ŒæŠŠbçš„å€¼å‡äº†ä¸€ä¸‹ï¼ŒæŠŠcçš„å€¼åŠ äº†ä¸€ä¸‹ç­‰ç­‰ã€‚è§£å†³ABAé—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥è€ƒè™‘å¢åŠ ä¸€ä¸ªä¿®æ”¹è®¡æ•°ï¼ˆç‰ˆæœ¬å·ï¼‰ï¼Œåªæœ‰ä¿®æ”¹è®¡æ•°ä¸å˜çš„ä¸”aå€¼ä¸å˜çš„æƒ…å†µä¸‹æ‰åša++ï¼ŒatomicåŒ…ä¸‹æœ‰AtomicStampedReferenceç±»åšè¿™ä¸ªäº‹æƒ…ï¼Œè¿™å’Œäº‹åŠ¡åŸå­æ€§å¤„ç†æœ‰ç‚¹ç±»ä¼¼ï¼</p>
<p>##å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</p>
<ol>
<li>å³ä½¿æ²¡æœ‰ä»»ä½•äº‰ç”¨ä¹Ÿä¼šåšä¸€äº›æ— ç”¨åŠŸ</li>
<li>å¦‚æœå†²çªæ¯”è¾ƒä¸¥é‡çš„è¯ï¼Œå¯èƒ½å¯¼è‡´å¤šæ¬¡ä¿®æ”¹å¤±è´¥ï¼Œforå¾ªç¯æ—¶é—´å¾ˆé•¿ï¼Œå¯èƒ½æ¯”åŒæ­¥è¿˜æ…¢</li>
</ol>
<p>æˆ‘åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šç”¨100ä¸ªçº¿ç¨‹å»ä¿®æ”¹ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå‘ç°ç”¨AtomicIntegerå°±æ¯”synchronizedæ…¢ï¼Œä½†æ˜¯éƒ½å¾ˆå¿«ï¼æ‰€ä»¥è¿˜æ˜¯é‚£ä¸ªå»ºè®®ï¼Œä¸è¦è¿‡æ—©ä¼˜åŒ–ï¼Œä¸è¦çº ç»“åˆ°åº•æ˜¯1msè¿˜æ˜¯2msï¼Œé™¤éæµ‹è¯•ä¹‹åå‘ç°ç¡®å®æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œç„¶åå†ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯ä»£ç çš„ä½¿ç”¨æœ‰é—®é¢˜ï¼Œè¦ç›¸ä¿¡ï¼Œèƒ½å†™åˆ°JDKé‡Œçš„ä»£ç ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šæœ‰é—®é¢˜ã€‚ä¸€èˆ¬ä¸åˆ°ä¸€å¤©å‡ åƒä¸‡ä¸Šäº¿çš„PVï¼Œåº”è¯¥æ˜¯æ²¡å•¥é—®é¢˜çš„ã€‚è€Œä¸”JVMå¯¹synchronizedåšäº†å¾ˆå¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬é”å»é™¤ï¼ˆLock Eliminationï¼‰ï¼Œè½»é‡çº§é”ï¼Œåå‘é”ç­‰ï¼Œæ‰€ä»¥å†™ä»£ç çš„æ—¶å€™é¦–å…ˆè¿˜æ˜¯ä¸»è¦è€ƒè™‘ä»£ç æ­£ç¡®ã€æ¸…æ™°ã€å¯ç»´æŠ¤ã€‚</p>
<p>##åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</p>
<p>å¦‚æœå¹¶å‘çº¦æŸæ¡ä»¶æ¶‰åŠåˆ°ä¸¤ä¸ªå˜é‡ï¼Œå°±ä¸èƒ½ç”¨ä¸¤ä¸ªåŸå­å˜é‡æ¥è¾¾åˆ°æ•´ä½“çš„åŸå­æ€§ï¼Œè¿˜æ˜¯å¾—ç”¨åŒæ­¥ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªå˜é€šçš„æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ªclassï¼Œé‡Œé¢åŒ…å«çº¦æŸæ¡ä»¶æ¶‰åŠåˆ°çš„å˜é‡ï¼Œç„¶åç”¨AtomicReferenceæ¥å®ç°åŸå­æ€§ã€‚</p>
<p>#æ€»ç»“</p>
<p>atomicåŒ…ä¸‹çš„ç±»æ¯”å¦‚AtomicIntegerå®ç°åŸå­æ€§çš„æ–¹æ³•ä¸»è¦æ˜¯ä¾é ç°ä»£ä¸»æµ CPU éƒ½æ”¯æŒçš„CASæŒ‡ä»¤ï¼Œå®ƒæ˜¯é€šè¿‡Unsafeç±»çš„nativeæ–¹æ³•è°ƒç”¨çš„ã€‚ä¸€èˆ¬è€Œè¨€æ€§èƒ½æ¯”ç”¨é”åŒæ­¥è¦å¥½ï¼Œä½†æ˜¯éƒ½å·²ç»å¾ˆå¥½äº†ï¼Œä¸€èˆ¬è€Œè¨€ä¸ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œå…³é”®è¿˜æ˜¯çœ‹å®ƒçš„è¯­ä¹‰æ˜¯å¦æ»¡è¶³ä½¿ç”¨è¦æ±‚ï¼Œä»¥åŠæ˜¯å¦å¯ä»¥è®©ä»£ç æ›´æ¸…æ–°ã€‚</p>
<p>Refers</p>
<ol>
<li><a href="http://my.oschina.net/lifany/blog/133513" target="_blank" rel="external">http://my.oschina.net/lifany/blog/133513</a></li>
<li><a href="http://zl198751.iteye.com/blog/1848575" target="_blank" rel="external">http://zl198751.iteye.com/blog/1848575</a></li>
<li><a href="http://blog.csdn.net/aesop_wubo/article/details/7537960" target="_blank" rel="external">http://blog.csdn.net/aesop_wubo/article/details/7537960</a></li>
<li><a href="http://my.oschina.net/u/177808/blog/166819" target="_blank" rel="external">http://my.oschina.net/u/177808/blog/166819</a></li>
<li><a href="http://www.blogjava.net/mstar/archive/2013/04/24/398351.html" target="_blank" rel="external">http://www.blogjava.net/mstar/archive/2013/04/24/398351.html</a></li>
<li><a href="http://mishadoff.com/blog/java-magic-part-4-sun-dot-misc-dot-unsafe/" target="_blank" rel="external">http://mishadoff.com/blog/java-magic-part-4-sun-dot-misc-dot-unsafe/</a></li>
<li><a href="http://zeroturnaround.com/rebellabs/dangerous-code-how-to-be-unsafe-with-java-classes-objects-in-memory/" target="_blank" rel="external">http://zeroturnaround.com/rebellabs/dangerous-code-how-to-be-unsafe-with-java-classes-objects-in-memory/</a></li>
<li><a href="http://www.pwendell.com/2012/08/13/java-lock-free-deepdive.html" target="_blank" rel="external">http://www.pwendell.com/2012/08/13/java-lock-free-deepdive.html</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;java5ä¹‹åçš„java.util.concurrentåŒ…æ˜¯ä¸–ç•Œçº§å¹¶å‘å¤§å¸ˆDoug Leaçš„ä½œå“ï¼Œé‡Œé¢ä¸»è¦å®ç°äº†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;atomicåŒ…é‡ŒInteger/Longå¯¹åº”çš„åŸå­ç±»ï¼Œä¸»è¦åŸºäºCASï¼›&lt;/li&gt;
&lt;li&gt;ä¸€äº›åŒæ­¥å­ï¼ŒåŒ…æ‹¬Lockï¼ŒCountDownLatchï¼ŒSemaphoreï¼ŒFutureTaskç­‰ï¼Œè¿™äº›éƒ½æ˜¯åŸºäºAbstractQueuedSynchronizerç±»ï¼›&lt;/li&gt;
&lt;li&gt;å…³äºçº¿ç¨‹æ‰§è¡Œçš„Executorsç±»ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€äº›å¹¶å‘çš„é›†åˆç±»ï¼Œæ¯”å¦‚ConcurrentHashMapï¼ŒConcurrentLinkedQueueï¼ŒCopyOnWriteArrayListç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»atomicåŒ…ä¸‹ç›¸å…³å†…å®¹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://magicly.me/categories/Java/"/>
    
    
      <category term="Java" scheme="http://magicly.me/tags/Java/"/>
    
      <category term="concurrency" scheme="http://magicly.me/tags/concurrency/"/>
    
      <category term="jdk" scheme="http://magicly.me/tags/jdk/"/>
    
      <category term="æºç é˜…è¯»" scheme="http://magicly.me/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>Java Concurrencyï¼ˆä¸‰ï¼‰â€”â€”J.U.C AQSæºç è§£è¯»</title>
    <link href="http://magicly.me/2015/01/13/java-concurrrency-3-juc-source-code-read/"/>
    <id>http://magicly.me/2015/01/13/java-concurrrency-3-juc-source-code-read/</id>
    <published>2015-01-13T13:34:10.000Z</published>
    <updated>2016-11-29T02:57:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>java5ä¹‹åçš„java.util.concurrentåŒ…æ˜¯ä¸–ç•Œçº§å¹¶å‘å¤§å¸ˆDoug Leaçš„ä½œå“ï¼Œé‡Œé¢ä¸»è¦å®ç°äº†</p>
<ol>
<li>atomicåŒ…é‡ŒInteger/Longå¯¹åº”çš„åŸå­ç±»ï¼Œä¸»è¦åŸºäºCASï¼›</li>
<li>ä¸€äº›åŒæ­¥å­ï¼ŒåŒ…æ‹¬Lockï¼ŒCountDownLatchï¼ŒSemaphoreï¼ŒFutureTaskç­‰ï¼Œè¿™äº›éƒ½æ˜¯åŸºäºAbstractQueuedSynchronizerç±»ï¼›</li>
<li>å…³äºçº¿ç¨‹æ‰§è¡Œçš„Executorsç±»ç­‰ï¼›</li>
<li>ä¸€äº›å¹¶å‘çš„é›†åˆç±»ï¼Œæ¯”å¦‚ConcurrentHashMapï¼ŒConcurrentLinkedQueueï¼ŒCopyOnWriteArrayListç­‰ã€‚</li>
</ol>
<p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»AbstractQueuedSynchronizerè¿™ä¸ªå¯ä»¥è¯´æ˜¯æœ€æ ¸å¿ƒçš„ç±»ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚æ•´ä¸ªconcurrentåŒ…é‡Œï¼ŒåŸºæœ¬éƒ½ç›´æ¥æˆ–é—´æ¥åœ°ç”¨åˆ°äº†è¿™ä¸ªç±»ã€‚Doug Leaçš„è¿™ç¯‡<a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf" target="_blank" rel="external">è®ºæ–‡</a>é‡Œé¢è®²AQSçš„å®ç°ã€‚</p>
<a id="more"></a>
<p>#AQS</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€é—´å±‹é‡Œæœ‰ä¸€ä¸ªå¤§å®¶éƒ½æƒ³è¦å¾—åˆ°çš„ä¼šè®©ä½ å¾ˆçˆ½çš„ä¸œè¥¿ï¼ˆsomething which makes you so happy, e.g. W.Cï¼‰ã€‚å½“æœ‰äººè¿›å»æŠŠé—¨å…³èµ·æ¥åœ¨ç‹¬å äº«ç”¨çš„æ—¶å€™ï¼Œå…¶ä»–äººå°±åªèƒ½åœ¨å¤–é¢æ’é˜Ÿç­‰å¾…ï¼Œæ—¢ç„¶åœ¨ç­‰å¾…ï¼Œä½ å°±ä¸èƒ½è€æ˜¯å»æ•²é—¨è¯´å“ï¼Œå¥½äº†æ²¡æœ‰å•Šã€‚è€æ˜¯è¿™æ ·çš„è¯é‡Œé¢çš„äººå°±å¾ˆä¸çˆ½äº†ï¼Œè€Œä¸”ä½ å¯ä»¥åˆ©ç”¨è¿™ç‚¹ç­‰å¾…æ—¶é—´å¹²ç‚¹åˆ«çš„ï¼Œæ¯”å¦‚çœ‹çœ‹å°è¯´è§†é¢‘èƒŒèƒŒå•è¯æˆ–è€…å°±å¹²è„†æ¤…å­ä¸Šç¡è§‰ï¼Œå½“å‰é¢ç‹¬å çš„äººçˆ½å®Œä¹‹åï¼Œå°±ä¼šå‡ºæ¥è¯´ï¼Œå•Šï¼Œå¥½çˆ½ï¼Œåˆ°ä½ ä»¬äº†ã€‚ç„¶åå¤§å®¶å¯èƒ½æŒ‰ç…§æ’é˜Ÿé¡ºåºè·å–æˆ–è€…å¤§å®¶ç–¯æŠ¢è¿™ä¸ªçŠ¶æ€ï¼Œæœ‰å¯èƒ½ä¸€ä¸ªäººè‡ªå·±è¿›å»ç‹¬å ï¼Œæœ‰å¯èƒ½å‡ ä¸ªäººè¯´ï¼Œå“æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ¥ã€‚ç„¶åä»–ä»¬è¿›å»çˆ½ï¼Œçˆ½å®Œä¹‹åå†å‡ºæ¥é€šçŸ¥ä¸‹ä¸€ä¸ªã€‚</p>
<p>æˆ‘ä»¬æ¥æŠŠä¸Šé¢è¿™æ®µè¯ç¿»è¯‘æˆAQSé‡Œé¢çš„æœ¯è¯­ã€‚æœ‰ä¸€ä¸ªçŠ¶æ€stateï¼Œä¼šæœ‰å¤šä¸ªThreadå°è¯•è·å–ï¼Œå½“ä¸€ä¸ªThreadç‹¬å ï¼ˆEXCLUSIVEï¼Œæ¯”å¦‚Lockï¼‰ä¹‹åï¼Œå…¶ä»–åé¢åˆ°æ¥çš„Threadå°±ä¼šè¢«æ”¾åˆ°ä¸€ä¸ªQueueçš„é˜Ÿå°¾ï¼ˆtailï¼‰ï¼Œç„¶åç¡çœ ï¼ˆparkï¼‰ï¼Œä¸€ç›´ç­‰åˆ°å‰é¢çš„Threadå”¤é†’ï¼ˆunparkï¼‰å®ƒï¼Œå½“ç„¶è¿™é‡Œæœ‰å¯èƒ½è¢«å‡å”¤é†’ï¼ˆå°±å¥½æ¯”ä½ å®šäº†é—¹é’Ÿ8ç‚¹èµ·åºŠï¼Œç»“æœ7ç‚¹å°±è‡ªç„¶é†’æˆ–è€…è¢«å¤–é¢è½¦åµé†’ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªThreadä¼šåˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯åˆ°è‡ªå·±äº†ï¼Œæ²¡æœ‰çš„è¯å°±ç»§ç»­parkï¼ˆåœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œï¼‰ï¼›å½“æ‹¥æœ‰stateçš„Threadé‡Šæ”¾ï¼ˆreleaseï¼‰ä¹‹åï¼Œå®ƒä¼šå”¤é†’Queueä¸­çš„ä¸‹ä¸€ä¸ªThreadï¼ˆunparkSuccessorï¼‰ã€‚ç„¶åä¸‹ä¸€ä¸ªThreadè·å–ï¼ˆacquireï¼‰åˆ°stateï¼Œå®Œæˆè‡ªå·±çš„ä»»åŠ¡ï¼Œç„¶åç»§ç»­unparkSuccessorã€‚å‰é¢ä¸»è¦è¯´çš„æ˜¯EXCLUSIVEæ¨¡å¼ï¼ŒAQSè¿˜æ”¯æŒå…±äº«ï¼ˆSHAREDï¼‰æ¨¡å¼ï¼ŒåŒºåˆ«åœ¨äºå°è¯•è·å–ï¼ˆtryAcquireSharedï¼‰çš„æ—¶å€™å³ä½¿ä¹‹å‰å·²ç»æœ‰Threadè·å–äº†stateï¼Œä½†æ˜¯å¯èƒ½ä»ç„¶èƒ½è·å–ï¼ˆæ¯”å¦‚ReadLockï¼‰ã€‚åŒæ ·é‡Šæ”¾ï¼ˆdoReleaseSharedï¼‰çš„æ—¶å€™é™¤äº†é€šçŸ¥Queueé‡Œé¢ç¬¬ä¸€ä¸ªï¼ˆheadï¼‰ï¼Œè¿˜ä¼šç»§ç»­é€šçŸ¥åç»­çš„èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼Œåªè¦å®ƒä»¬æ˜¯SHAREDã€‚</p>
<p>AQSå°±æ˜¯å®ç°äº†ï¼š</p>
<ol>
<li>è‡ªåŠ¨ç®¡ç†è¿™ä¸ªåŒæ­¥çŠ¶æ€stateï¼ˆintç±»å‹ï¼‰ï¼Œæ›´æ–°çš„æ—¶å€™éœ€è¦ç”¨CASä¿è¯åŸå­æ€§</li>
<li>é˜»å¡å’Œå”¤é†’çº¿ç¨‹park/unpark</li>
<li>é˜Ÿåˆ—ç®¡ç†ï¼Œä¸€ä¸ªåŒå‘é“¾è¡¨å®ç°queue</li>
</ol>
<p>AQSæ˜¯ä¸€ä¸ªabstract classï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿AQSï¼Œå®šä¹‰stateçš„å«ä¹‰ï¼Œä»¥åŠtryAcquireï¼ŒtryReleaseï¼Œä»¥åŠå¯¹åº”çš„shareæ¨¡å¼ä¸‹tryAcquireSharedï¼ŒtryReleaseSharedè¿™å‡ ä¸ªæ–¹æ³•ï¼Œå®šä¹‰å‡ºè‡ªå·±æƒ³è¦çš„åŒæ­¥å­ï¼ˆSynchronizersï¼‰ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ˜¯å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»Sync extends AQSï¼Œå®ç°å‰é¢è¯´çš„å‡ ä¸ªæ–¹æ³•ï¼Œç„¶åå†åŒ…ä¸€å±‚ï¼Œæš´éœ²å‡ºç›¸åº”çš„æ–¹æ³•ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä½ å¯ä»¥åœ¨åŒ…è£…å™¨ç±»é‡Œé¢å–æ›´ç›´è§‚çš„åå­—ï¼Œå¦‚ReentrantLocké‡Œçš„lockï¼Œunlockå’ŒCountDownLatché‡Œçš„countDownï¼Œawaitï¼Œè€Œä¸æ˜¯å¤ªé€šç”¨çš„acquireå’Œreleaseç­‰ã€‚è€Œä¸”AQSé‡Œé¢ä¸€äº›æ–¹æ³•æ˜¯ä¸ºäº†ç›‘æ§å’Œè°ƒè¯•ä½¿ç”¨ï¼Œç›´æ¥æš´éœ²å‡ºæ¥ä¹Ÿä¸å¥½ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹J.U.Cé‡Œé¢ä¸¤ä¸ªå¸¸ç”¨çš„Synchronizersã€‚</p>
<p>#ReentrantLock</p>
<p>##ä½¿ç”¨</p>
<p>ReentrantLockçš„è¯­ä¹‰è·Ÿsynchronizedå…³é”®å­—åŸºæœ¬ä¸€æ ·ï¼Œè€Œä¸”æˆ‘ä¹‹å‰çœ‹<a href="http://book.douban.com/subject/6522893/" target="_blank" rel="external">ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</a>é‡Œé¢çš„è¯„æµ‹è¯´JDK6ä¹‹åï¼Œä¸¤è€…çš„æ•ˆç‡åŸºæœ¬ä¸€è‡´äº†ï¼ˆJDK5ä¹‹å‰ReentrantLockè¦æ¯”synchronizedå¿«å¾ˆå¤šï¼‰ã€‚Javadocé‡Œé¢è¯´åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight cs"><table><tr><td class="code"><pre><div class="line"><span class="keyword">class</span> <span class="title">X</span> &#123;</div><div class="line">  <span class="keyword">private</span> final ReentrantLock <span class="keyword">lock</span> = <span class="keyword">new</span> ReentrantLock();</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">lock</span>.<span class="keyword">lock</span>();  <span class="comment">// block until condition holds</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="comment">// ... method body</span></div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">      <span class="keyword">lock</span>.unlock()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##æºç </p>
<p>ReentrantLockç”¨stateè¡¨ç¤ºæ˜¯å¦è¢«é”ï¼Œ0è¡¨ç¤ºæ²¡æœ‰çº¿ç¨‹è·å–åˆ°é”ï¼Œ&gt;=1è¡¨ç¤ºæŸä¸ªçº¿ç¨‹è·å–äº†Næ¬¡é”ï¼ˆå› ä¸ºæ˜¯é‡å…¥çš„ï¼Œåªè¦ä¿è¯lockå’Œunlockæˆå¯¹å‡ºç°å°±æ²¡æœ‰é—®é¢˜ï¼‰ã€‚<br><figure class="highlight scala"><table><tr><td class="code"><pre><div class="line"><span class="comment">/** Synchronizer providing all implementation mechanics */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Sync</span> sync;</div><div class="line"></div><div class="line"><span class="keyword">abstract</span> static <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</div></pre></td></tr></table></figure></p>
<p>å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»ï¼ŒåŸºæœ¬ä»»åŠ¡éƒ½ä»£ç†ç»™syncå®Œæˆã€‚è€ŒSyncåˆæ˜¯ä¸€ä¸ªabstract classï¼Œè¿™é‡Œä¸»è¦æ˜¯å› ä¸ºå®ç°äº†ä¸¤ç§æŠ¢å é”çš„æœºåˆ¶ï¼Œå…¬å¹³é”å’Œéå…¬å¹³é”ã€‚<br><figure class="highlight scala"><table><tr><td class="code"><pre><div class="line">static <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span></span></div><div class="line"></div><div class="line">static <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NonfairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span></span></div></pre></td></tr></table></figure></p>
<p>æ‰€è°“å…¬å¹³ä¸å…¬å¹³ç®€å•æ¥è¯´å°±æ˜¯æœ¬æ–‡å¼€å¤´è¯´çš„ï¼Œå½“èµ„æºé‡Šæ”¾çš„æ—¶å€™ï¼Œå¤§å®¶æ˜¯æŒ‰ç…§æ’é˜Ÿé¡ºåºå…ˆåˆ°å…ˆå¾—ï¼Œè¿˜æ˜¯æœ‰äººæ’é˜Ÿå¤§å®¶ç–¯æŠ¢ã€‚</p>
<p>æä¾›äº†ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">()</span> </span>&#123;</div><div class="line">       sync = <span class="keyword">new</span> NonfairSync();<span class="comment">//é»˜è®¤éå…¬å¹³é”ï¼ŒAQSè®ºæ–‡è¯´éå…¬å¹³é”æ•ˆç‡é«˜äº›ï¼Œç†ç”±å…¶å®å¾ˆç®€å•ï¼Œå…¬å¹³é”é€šçŸ¥é˜Ÿåˆ—ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¦æŠŠå®ƒå”¤é†’ï¼Œè€Œå”¤é†’æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œåœ¨é”é‡Šæ”¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¢«å”¤é†’è¿™æ®µæ—¶é—´å…¶å®é”æ˜¯å¯ä»¥ç”¨ä½†æ˜¯æ²¡æœ‰è¢«ç”¨çš„ï¼ˆavailable but not usedï¼‰ï¼›è€Œéå…¬å¹³é”ï¼Œé‡Šæ”¾äº†ä¹‹åç«‹é©¬å°±å¯ä»¥è¢«åˆ«äººç”¨ï¼Œæ‰€ä»¥æé«˜äº†æ•ˆç‡ï¼Œä½†æ˜¯æœ‰å¯èƒ½å¯¼è‡´é¥¥é¥¿é”ï¼Œè¿™ä¸ªå°±è¦å…·ä½“çœ‹ä¸šåŠ¡éœ€æ±‚äº†ã€‚</span></div><div class="line">   &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>&#123;</div><div class="line">       sync = fair ? <span class="keyword">new</span> FairSync() : <span class="keyword">new</span> NonfairSync();<span class="comment">//æŒ‡å®šå…¬å¹³ä¸å¦</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>åŠ é”çš„å®ç°<br><figure class="highlight cs"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span>(<span class="params"></span>) </span>&#123;</div><div class="line">       sync.<span class="keyword">lock</span>();</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>ç®€å•ä»£ç†ç»™äº†syncï¼Œåœ¨FairSyncé‡Œä¸º<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">	acquire(<span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>acquireçš„å®ç°åœ¨AQSé‡Œé¢ï¼š<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</div><div class="line">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</div><div class="line">        selfInterrupt();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>tryAcquireæ˜¯è¦åœ¨å­ç±»é‡Œè‡ªå·±å®ç°çš„ï¼Œåœ¨FairSyncå¦‚ä¸‹;<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</div><div class="line">         <span class="keyword">final</span> Thread current = Thread.currentThread();</div><div class="line">         <span class="keyword">int</span> c = getState();</div><div class="line">         <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;<span class="comment">//0è¡¨ç¤ºé”æ²¡æœ‰è¢«çº¿ç¨‹ç”¨ï¼Œ1è¡¨ç¤ºå·²ç»æœ‰çº¿ç¨‹å ç”¨</span></div><div class="line">             <span class="keyword">if</span> (!hasQueuedPredecessors() &amp;&amp; <span class="comment">//åˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ç°å…¬å¹³</span></div><div class="line">                 compareAndSetState(<span class="number">0</span>, acquires)) &#123;<span class="comment">//CASæ›´æ–°çŠ¶æ€</span></div><div class="line">                 setExclusiveOwnerThread(current);<span class="comment">//è®¾ç½®å½“å‰çº¿ç¨‹æ‹¥æœ‰çŠ¶æ€</span></div><div class="line">                 <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;<span class="comment">//1è¡¨ç¤ºå·²ç»æœ‰çº¿ç¨‹å ç”¨ï¼Œå†åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è¢«å½“å‰çº¿ç¨‹å ç”¨ï¼Œæ¥å®ç°é‡å…¥ï¼ˆReentrantï¼‰ç‰¹æ€§</span></div><div class="line">             <span class="keyword">int</span> nextc = c + acquires;</div><div class="line">             <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>)</div><div class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</div><div class="line">             setState(nextc);<span class="comment">//æ›´æ–°çŠ¶æ€</span></div><div class="line">             <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœè·å–å¤±è´¥ï¼ŒaddWaiter(Node.EXCLUSIVE)å°†å½“å‰çº¿ç¨‹åŠ å…¥é˜Ÿå°¾<br><figure class="highlight crmsh"><table><tr><td class="code"><pre><div class="line">private <span class="keyword">Node</span> <span class="title">addWaiter</span>(<span class="keyword">Node</span> <span class="title">mode</span>) &#123;</div><div class="line">       <span class="keyword">Node</span> <span class="title">node</span> = new <span class="keyword">Node</span><span class="title">(Thread</span>.currentThread(), mode);//ç”¨å½“å‰çº¿ç¨‹æ„é€ <span class="keyword">Node</span><span class="title">ï¼Œç‹¬å æ¨¡å¼</span></div><div class="line">       // Try the fast path of enq; backup to full enq on failure</div><div class="line">       <span class="keyword">Node</span> <span class="title">pred</span> = tail;</div><div class="line">       if (pred != null) &#123;</div><div class="line">           <span class="keyword">node</span>.<span class="title">prev</span> = pred;</div><div class="line">           if (compareAndSetTail(pred, <span class="keyword">node</span><span class="title">)) &#123;//å¿«é€Ÿåˆ¤æ–­ï¼ŒCAS</span>æ›´æ–°tailèŠ‚ç‚¹</div><div class="line">               pred.next = <span class="keyword">node</span><span class="title">;</span></div><div class="line">               return <span class="keyword">node</span><span class="title">;</span></div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       enq(<span class="keyword">node</span><span class="title">);//å¦‚æœå¤±è´¥ï¼Œè¿›å…¥enq</span>æ–¹æ³•</div><div class="line">       return <span class="keyword">node</span><span class="title">;</span></div><div class="line">   &#125;</div><div class="line">   </div><div class="line"> private <span class="keyword">Node</span> <span class="title">enq</span>(final <span class="keyword">Node</span> <span class="title">node</span>) &#123;</div><div class="line">       for (;;) &#123;</div><div class="line">           <span class="keyword">Node</span> <span class="title">t</span> = tail;</div><div class="line">           if (t == null) &#123; // Must initialize</div><div class="line">               if (compareAndSetHead(new <span class="keyword">Node</span><span class="title">()))//å¦‚æœè¿˜æ²¡æœ‰head</span>ï¼ŒCASåˆå§‹åŒ–ä¸€ä¸ªhead</div><div class="line">                   tail = head;</div><div class="line">           &#125; else &#123;//è¿™æ®µä»£ç è·ŸaddWaiteré‡Œä¸€æ ·ï¼ŒCASæ›´æ–°tailèŠ‚ç‚¹</div><div class="line">               <span class="keyword">node</span>.<span class="title">prev</span> = t;</div><div class="line">               if (compareAndSetTail(t, <span class="keyword">node</span><span class="title">)) &#123;</span></div><div class="line">                   t.next = <span class="keyword">node</span><span class="title">;</span></div><div class="line">                   return t;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å°†è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥é˜Ÿå°¾äº†ï¼Œç°åœ¨è¦å°†å®ƒæŒ‚èµ·acquireQueued(addWaiter(Node.EXCLUSIVE), arg))ï¼š<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">       <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</div><div class="line">           <span class="keyword">for</span> (;;) &#123;<span class="comment">//åœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­ï¼Œé¿å…å‡å”¤é†’</span></div><div class="line">               <span class="keyword">final</span> Node p = node.predecessor();<span class="comment">//è·å–å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯headè¯´æ˜è‡ªå·±æ˜¯ç¬¬ä¸€ä¸ªå¯ä»¥è·å–èµ„æºçš„çº¿ç¨‹ï¼Œå®ç°å…¬å¹³</span></div><div class="line">               <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;<span class="comment">//æ˜¯ç¬¬ä¸€ä¸ªå¯ä»¥è·å–èµ„æºçš„çº¿ç¨‹å¹¶ä¸”å°è¯•è·å–æˆåŠŸ</span></div><div class="line">                   setHead(node);</div><div class="line">                   p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></div><div class="line">                   failed = <span class="keyword">false</span>;</div><div class="line">                   <span class="keyword">return</span> interrupted;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</div><div class="line">                   parkAndCheckInterrupt())<span class="comment">//æ²¡æœ‰è·å–åˆ°èµ„æºï¼Œç¡çœ parkå»</span></div><div class="line">                   interrupted = <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125; <span class="keyword">finally</span> &#123;</div><div class="line">           <span class="keyword">if</span> (failed)</div><div class="line">               cancelAcquire(node);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>&#123;</div><div class="line">       LockSupport.park(<span class="keyword">this</span>);</div><div class="line">       <span class="function"><span class="keyword">return</span> Thread.<span class="title">interrupted</span><span class="params">()</span></span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢å®Œæˆäº†è·å–é”çš„è¿‡ç¨‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯å°è¯•è·å–ï¼Œå¤±è´¥å°±åŠ å…¥é˜Ÿå°¾ï¼ŒæŒ‚èµ·ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p>
<p>ä¸‹é¢æ¥çœ‹çœ‹é‡Šæ”¾é”<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</div><div class="line">        sync.release(<span class="number">1</span>);<span class="comment">//ä»£ç†ç»™syncï¼Œè°ƒç”¨AQSçš„release</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//ä¸‹é¢ä»£ç åœ¨AQSä¸­</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (tryRelease(arg)) &#123;<span class="comment">//å°è¯•é‡Šæ”¾èµ„æºï¼Œéœ€è¦åœ¨å­ç±»é‡Œå®ç°</span></div><div class="line">            Node h = head;</div><div class="line">            <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</div><div class="line">                unparkSuccessor(h);<span class="comment">//é€šçŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>&#123;</div><div class="line">        <span class="comment">/*</span></div><div class="line">         * If status is negative (i.e., possibly needing signal) try</div><div class="line">         * to clear in anticipation of signalling.  It is OK if this</div><div class="line">         * fails or if status is changed by waiting thread.</div><div class="line">         */</div><div class="line">        <span class="keyword">int</span> ws = node.waitStatus;</div><div class="line">        <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</div><div class="line">            compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line">         * Thread to unpark is held in successor, which is normally</div><div class="line">         * just the next node.  But if cancelled or apparently null,</div><div class="line">         * traverse backwards from tail to find the actual</div><div class="line">         * non-cancelled successor.</div><div class="line">         */</div><div class="line">         <span class="comment">// ä¸»è¦åœ¨è¿™é‡Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªéœ€è¦é€šçŸ¥çš„èŠ‚ç‚¹ï¼Œå¦‚æœnode.nextå°±æ˜¯éœ€è¦é€šçŸ¥çš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥é€šçŸ¥ï¼›å¦åˆ™ï¼Œå¯èƒ½node.next == nullï¼ˆåŸå› æ˜¯åŒå‘é“¾è¡¨è®¾ç½®b.pre = aå’Œa.next = bçš„æ—¶å€™ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œåªèƒ½ä¿è¯b.pre = aæˆåŠŸï¼Œè¿™æ—¶å€™å¦ä¸€æ¡çº¿ç¨‹å¯èƒ½çœ‹åˆ°a.next == nullï¼‰æˆ–è€…s.waitStatus &gt; 0ï¼ˆåŸå› æ˜¯çº¿ç¨‹ç­‰ä¸åŠè¢«å–æ¶ˆäº†static final int CANCELLED = 1;ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ä»é˜Ÿå°¾tailå¼€å§‹æ‰¾ï¼Œæ‰¾åˆ°ç¦»é˜Ÿå¤´headæœ€è¿‘çš„ä¸€ä¸ªéœ€è¦é€šçŸ¥çš„èŠ‚ç‚¹Nodeã€‚</span></div><div class="line">        Node s = node.next;</div><div class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</div><div class="line">            s = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> &amp;&amp; t != node; t = t.prev)</div><div class="line">                <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</div><div class="line">                    s = t;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (s != <span class="keyword">null</span>)</div><div class="line">            LockSupport.unpark(s.thread);<span class="comment">//å”¤é†’çº¿ç¨‹</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>çœ‹çœ‹éœ€è¦åœ¨å­ç±»é‡Œå®ç°çš„tryReleaseï¼š<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</div><div class="line">          <span class="keyword">int</span> c = getState() - releases;<span class="comment">//é‡Šæ”¾é”ï¼Œstateå‡å»ç›¸åº”çš„å€¼</span></div><div class="line">          <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</div><div class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();<span class="comment">//é¿å…Açº¿ç¨‹é”äº†ä¹‹åï¼ŒBçº¿ç¨‹æ•…æ„æ£ä¹±é‡Šæ”¾é”</span></div><div class="line">          <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</div><div class="line">          <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;<span class="comment">//å½“å‰çº¿ç¨‹å·²ç»å®Œå…¨é‡Šæ”¾äº†é”</span></div><div class="line">              free = <span class="keyword">true</span>;</div><div class="line">              setExclusiveOwnerThread(<span class="keyword">null</span>);<span class="comment">//é‡Šæ”¾é”çš„æ‹¥æœ‰è€…</span></div><div class="line">          &#125;</div><div class="line">          setState(c);<span class="comment">//è®¾ç½®çŠ¶æ€ï¼Œè¿™ä¸ªæ–¹é¢æ²¡æœ‰åŒæ­¥ï¼Œæ²¡æœ‰CASï¼Œæœ‰åŒå­¦é—®è¿‡å²‚ä¸æ˜¯æœ‰çº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Ÿå…¶å®åˆ°è¿™é‡Œï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘é”™è¯¯ï¼Œä»”ç»†æƒ³æƒ³ï¼Œæ˜¯å§ï¼Ÿæ˜¯å§ï¼Ÿ</span></div><div class="line">          <span class="keyword">return</span> free;</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<p>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬éƒ½å·²ç»å®Œæˆï¼Œå¯¹äº†ï¼Œè¿˜æ²¡æœ‰è¯´éå…¬å¹³é”NonfairSyncæ˜¯æ€ä¹ˆæŠ¢å é”çš„ã€‚<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))<span class="comment">//å…ˆæŠ¢ä¸€æŠŠï¼ˆæ’é˜Ÿï¼‰ï¼Œä¸‡ä¸€æˆåŠŸäº†å°±ä¸æ’é˜Ÿï¼Œä¸å…¬å¹³æ€§å°±ä½“ç°åœ¨è¿™é‡Œï¼</span></div><div class="line">              setExclusiveOwnerThread(Thread.currentThread());</div><div class="line">          <span class="keyword">else</span></div><div class="line">              acquire(<span class="number">1</span>);</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<p>è·ŸFairSync.lock()å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåªæ˜¯åœ¨acquire(1)ä¹‹å‰ï¼Œå…ˆæŠ¢ä¸€æŠŠï¼ŒæŠ¢ä¸åˆ°æ‰ä¹–ä¹–çš„å»æ’é˜Ÿã€‚</p>
<p>æˆ‘ä»¬å†çœ‹çœ‹NonfairSync.tryAcquire()æ€ä¹ˆå®ç°çš„<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</div><div class="line">          <span class="function"><span class="keyword">return</span> <span class="title">nonfairTryAcquire</span><span class="params">(acquires)</span></span>;<span class="comment">//è°ƒç”¨çˆ¶ç±»æ–¹æ³•nonfairTryAcquire</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</div><div class="line">          <span class="keyword">final</span> Thread current = Thread.currentThread();</div><div class="line">          <span class="keyword">int</span> c = getState();</div><div class="line">          <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</div><div class="line">              <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123;<span class="comment">//è·ŸFairSync.tryAcquireåªæœ‰è¿™é‡Œä¸€è¡Œæœ‰å·®å¼‚ï¼Œå³å°‘äº†!hasQueuedPredecessors()ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åˆ¤æ–­å‰é¢æœ‰æ²¡æœ‰äººï¼Œä»»ä½•æ—¶å€™åªè¦å®ƒé†’æ¥ï¼Œéƒ½ä¼šå»æŠ¢ï¼Œæ‰€ä»¥ä¸å…¬å¹³ï¼============åˆšåˆçœ‹äº†ä¸€éï¼Œå‘ç°å…¶å®final boolean acquireQueued(final Node node, int arg)æ–¹æ³•é‡Œå·²ç»æœ‰node.predecessor() == headçš„åˆ¤æ–­ï¼Œæ„Ÿè§‰è¿™ä¸ªä¸å…¬å¹³çš„tryAcquireè²Œä¼¼æ²¡æœ‰æ„ä¹‰ï¼Œå„ä½çœ‹å®˜æ€ä¹ˆçœ‹å‘¢ï¼Œè¯·ç•™è¨€å“ˆï¼Œè°¢è°¢~</span></div><div class="line">                  setExclusiveOwnerThread(current);</div><div class="line">                  <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;</div><div class="line">              <span class="keyword">int</span> nextc = c + acquires;</div><div class="line">              <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></div><div class="line">                  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</div><div class="line">              setState(nextc);</div><div class="line">              <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<p>#CountDownLatch</p>
<p>æˆ‘ä»¬ä¹‹å‰è¯´äº†ï¼ŒAQSæ”¯æŒç‹¬å EXCLUSIVEå’Œå…±äº«SHAREDä¸¤ç§æ¨¡å¼ï¼Œè€Œåˆšåˆšçš„ReentrantLockçš„å°±æ˜¯ç‹¬å æ¨¡å¼ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªä½¿ç”¨å…±äº«æ¨¡å¼çš„ç±»ã€‚</p>
<p>##ä½¿ç”¨</p>
<p>CountDownLatchå°±å¥½æ¯”ä¸€é“é—¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥ç­‰æ‰€æœ‰èµ„æºéƒ½åˆ°é½äº†ï¼Œæ‰å¼€é—¨ï¼Œè®©è¿™äº›çº¿ç¨‹åŒæ—¶é€šè¿‡ã€‚æ¯”å¦‚å¦‚ä¸‹æ˜¯CountDownLatchä¸€ä¸ªé€šç”¨ç”¨æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> concurrentStudy;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by magicalli on 2014/12/13.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexPlusPlusTest01</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NThreads = <span class="number">10</span>;<span class="comment">// çº¿ç¨‹æ•°</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> M = <span class="number">100000</span>;<span class="comment">//å¾ªç¯æ¬¡æ•°ï¼Œå¤ªå°çš„è¯ï¼ˆæ¯”å¦‚10ï¼‰å¯èƒ½çœ‹ä¸å‡ºæ¥æ•ˆæœ</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="keyword">int</span> n = <span class="number">0</span>;<span class="comment">//åŠ volatileçš„ç›®çš„æ˜¯ä¸ºäº†è¯æ˜volatileæ²¡æœ‰â€œåŸå­æ€§â€ï¼</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        <span class="keyword">final</span> CountDownLatch startGate = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</div><div class="line">        <span class="keyword">final</span> CountDownLatch endGate = <span class="keyword">new</span> CountDownLatch(NThreads);</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NThreads; i++) &#123;</div><div class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        startGate.await();<span class="comment">//æ‰€æœ‰çº¿ç¨‹startä¹‹åç­‰å¾…â€œé—¨â€œæ‰“å¼€ï¼Œä¿è¯åŒæ—¶çœŸæ­£å¼€å§‹è¿è¡Œ</span></div><div class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++) &#123;</div><div class="line">                        n += <span class="number">1</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    endGate.countDown();</div><div class="line">                &#125;</div><div class="line">            &#125;).start();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        startGate.countDown();<span class="comment">//æ‰“å¼€â€œé—¨â€ï¼Œè®©æ‰€æœ‰çº¿ç¨‹åŒæ—¶runèµ·æ¥</span></div><div class="line">        <span class="keyword">long</span> t1 = System.currentTimeMillis();</div><div class="line">        endGate.await();<span class="comment">//ç­‰æ‰€æœ‰çº¿ç¨‹éƒ½ç»“æŸä¹‹åæ‰æ‰“å°nï¼Œå¦åˆ™æ€»æ˜¯ä¼šæ‰“å‡ºé”™è¯¯çš„nï¼›æˆ‘è§è¿‡è¿™é‡Œç”¨Thread.sleep()ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºï¼Œä½ æ€ä¹ˆçŸ¥é“è¯¥ç­‰å¤šä¹…æ‰èƒ½ä¿è¯æ‰€æœ‰çº¿ç¨‹ç»“æŸä»¥åŠåˆšå¥½ç»“æŸå‘¢ï¼Ÿï¼</span></div><div class="line">        <span class="keyword">long</span> t2 = System.currentTimeMillis();</div><div class="line">        System.out.println(<span class="string">"cost time: "</span> + (t2 - t1));</div><div class="line">        System.out.println(<span class="string">"n: "</span> + n);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹äº†ï¼Œä¸Šé¢ä»£ç æ˜¯æ‹¿æ¥éªŒè¯volatileä¸å…·å¤‡åŸå­æ€§çš„ï¼Œæ˜¯é”™è¯¯çš„ä»£ç å“¦ã€‚å¦‚æœæƒ³å¹¶å‘å®‰å…¨ï¼Œå¤§å®¶å¯ä»¥æƒ³æƒ³å¯ä»¥ç”¨å“ªäº›æ–¹å¼å®ç°ã€‚</p>
<p>##æºç </p>
<p>CountDownLatchåŒæ ·ä¹Ÿæ˜¯å®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿è‡ªAQSçš„å†…éƒ¨ç±»Syncï¼š<br><figure class="highlight scala"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> static <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span></span></div></pre></td></tr></table></figure></p>
<p>æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š<br><figure class="highlight axapta"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> CountDownLatch(<span class="keyword">int</span> <span class="keyword">count</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">count</span> &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"count &lt; 0"</span>);</div><div class="line">    <span class="keyword">this</span>.sync = <span class="keyword">new</span> Sync(<span class="keyword">count</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>countè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªä»»åŠ¡è¿˜åœ¨è¿è¡Œï¼Œæ¯ä¸ªThreadå®Œæˆäº†ä»»åŠ¡æˆ–è€…å‡†å¤‡å¥½å¼€å§‹ä¹‹å‰ï¼Œå°±ä¼šè°ƒç”¨countDownæ–¹æ³•å°†count-1ï¼Œå½“count==0æ—¶å€™ï¼Œawaitå°±ä¸å†é˜»å¡ï¼Œæ‰€æœ‰åœ¨ä¸Šé¢é˜»å¡çš„Threadéƒ½å¯ä»¥é¡ºåˆ©é€šè¿‡ã€‚<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    sync.acquireSharedInterruptibly(<span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç›´æ¥è°ƒç”¨AQSçš„acquireSharedInterruptiblyæ–¹æ³•ï¼Œä»æ–¹æ³•åå¯ä»¥çœ‹å‡ºï¼Œæ”¯æŒä¸­æ–­å“åº”<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">acquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></div><div class="line">        <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">    <span class="keyword">if</span> (Thread.interrupted())</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();<span class="comment">//å“åº”ä¸­æ–­</span></div><div class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</div><div class="line">        doAcquireSharedInterruptibly(arg);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>tryAcquireSharedåœ¨å­ç±»ä¸­å®ç°ï¼š<br><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : <span class="number">-1</span>;<span class="comment">//å¦‚æœstateä¸º0ï¼Œè¯´æ˜æ‰€æœ‰Threadå®Œæˆä»»åŠ¡ï¼Œå¯ä»¥ä¸é˜»å¡äº†</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œå°†ThreadåŠ å…¥é˜Ÿå°¾ï¼ŒæŒ‚èµ·ã€‚ä¸‹é¢è¿™ä¸ªæ–¹æ³•è·Ÿç‹¬å æ¨¡å¼ä¸‹acquireQueued(addWaiter(Node.EXCLUSIVE), arg))è¿™ä¸ªæ–¹æ³•ä»£ç æ˜¯åŸºæœ¬ä¸€è‡´çš„ã€‚<br><figure class="highlight crmsh"><table><tr><td class="code"><pre><div class="line">private void doAcquireSharedInterruptibly(int arg)</div><div class="line">       throws InterruptedException &#123;</div><div class="line">       final <span class="keyword">Node</span> <span class="title">node</span> = addWaiter(<span class="keyword">Node</span>.<span class="title">SHARED</span>);//å…±äº«æ¨¡å¼</div><div class="line">       boolean failed = <span class="literal">true</span>;</div><div class="line">       try &#123;</div><div class="line">           for (;;) &#123;</div><div class="line">               final <span class="keyword">Node</span> <span class="title">p</span> = <span class="keyword">node</span>.<span class="title">predecessor</span>();</div><div class="line">               if (p == head) &#123;</div><div class="line">                   int r = tryAcquireShared(arg);</div><div class="line">                   if (r &gt;= <span class="number">0</span>) &#123;</div><div class="line">                       setHeadAndPropagate(<span class="keyword">node</span><span class="title">, r</span>);//è·ŸEXCLUSIVEçš„ä¸€å¤§åŒºåˆ«</div><div class="line">                       p.next = null; // help GC</div><div class="line">                       failed = <span class="literal">false</span>;</div><div class="line">                       return;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">               if (shouldParkAfterFailedAcquire(p, <span class="keyword">node</span><span class="title">) &amp;&amp;</span></div><div class="line">                   parkAndCheckInterrupt())</div><div class="line">                   throw new InterruptedException();//å“åº”ä¸­æ–­ï¼Œè¿™é‡Œç›´æ¥æŠ›å¼‚å¸¸</div><div class="line">           &#125;</div><div class="line">       &#125; finally &#123;</div><div class="line">           if (failed)</div><div class="line">               cancelAcquire(<span class="keyword">node</span><span class="title">);</span></div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">private void setHeadAndPropagate(<span class="keyword">Node</span> <span class="title">node</span>, int propagate) &#123;</div><div class="line">       <span class="keyword">Node</span> <span class="title">h</span> = head; // Record old head for check below</div><div class="line">       setHead(<span class="keyword">node</span><span class="title">);</span></div><div class="line">       /*</div><div class="line">        * Try to signal next queued <span class="keyword">node</span> if:<span class="title"></span></div><div class="line">        *   Propagation was indicated by caller,</div><div class="line">        *     <span class="keyword">or</span> was recorded (as h.waitStatus either before</div><div class="line">        *     <span class="keyword">or</span> after setHead) by a previous operation</div><div class="line">        *     (note: this uses sign-check of waitStatus because</div><div class="line">        *      PROPAGATE status may transition to SIGNAL.)</div><div class="line">        * <span class="keyword">and</span></div><div class="line">        *   The next <span class="keyword">node</span> <span class="title">is</span> waiting <span class="keyword">in</span> shared mode,</div><div class="line">        *     <span class="keyword">or</span> we don't know, because it appears null</div><div class="line">        *</div><div class="line">        * The conservatism <span class="keyword">in</span> both of these checks may cause</div><div class="line">        * unnecessary wake-ups, but only when there are multiple</div><div class="line">        * racing acquires/releases, so most need signals now <span class="keyword">or</span> soon</div><div class="line">        * anyway.</div><div class="line">        */</div><div class="line">        // å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯æ„¿æ„å…±äº«ï¼Œå¹¶ä¸”ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯æ„¿æ„å…±äº«çš„ï¼Œé‚£ä¹ˆå°±è¿›å…¥doReleaseSharedï¼Œå”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸‹é¢ä¼šè¯¦è§£</div><div class="line">       if (propagate &gt; <span class="number">0</span> || h == null || h.waitStatus <span class="tag">&lt; 0 ||</span></div><div class="line">           (h = head) == null || h.waitStatus &lt; 0) &#123;</div><div class="line">           Node s = node.next;</div><div class="line">           if (s == null || s.isShared())</div><div class="line">               doReleaseShared();</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>å‰é¢å®Œæˆäº†ç­‰å¾…CountDownLatchçš„countå˜æˆ0çš„è¿‡ç¨‹ï¼Œä¸‹é¢çœ‹çœ‹countDown<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span> </span>&#123;</div><div class="line">       sync.releaseShared(<span class="number">1</span>);<span class="comment">//è°ƒç”¨AQSçš„</span></div><div class="line">   &#125;</div><div class="line"></div><div class="line"><span class="comment">// AQSä¸­</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">releaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (tryReleaseShared(arg)) &#123;<span class="comment">//å°è¯•é‡Šæ”¾ï¼Œéœ€è¦åœ¨å­ç±»ä¸­å®ç°</span></div><div class="line">           doReleaseShared();<span class="comment">//çœŸæ­£é‡Šæ”¾</span></div><div class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">	<span class="comment">// Syncå­ç±»ä¸­å®ç°</span></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</div><div class="line">           <span class="comment">// Decrement count; signal when transition to zero</span></div><div class="line">           <span class="keyword">for</span> (;;) &#123;</div><div class="line">               <span class="keyword">int</span> c = getState();</div><div class="line">               <span class="keyword">if</span> (c == <span class="number">0</span>)</div><div class="line">                   <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">               <span class="keyword">int</span> nextc = c<span class="number">-1</span>;</div><div class="line">               <span class="keyword">if</span> (compareAndSetState(c, nextc))<span class="comment">// åœ¨æ­»å¾ªç¯ä¸­CASå°†count-1</span></div><div class="line">                   <span class="keyword">return</span> nextc == <span class="number">0</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">   <span class="comment">// AQSä¸­</span></div><div class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">doReleaseShared</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">/*</span></div><div class="line">        * Ensure that a release propagates, even if there are other</div><div class="line">        * in-progress acquires/releases.  This proceeds in the usual</div><div class="line">        * way of trying to unparkSuccessor of head if it needs</div><div class="line">        * signal. But if it does not, status is set to PROPAGATE to</div><div class="line">        * ensure that upon release, propagation continues.</div><div class="line">        * Additionally, we must loop in case a new node is added</div><div class="line">        * while we are doing this. Also, unlike other uses of</div><div class="line">        * unparkSuccessor, we need to know if CAS to reset status</div><div class="line">        * fails, if so rechecking.</div><div class="line">        */</div><div class="line">       <span class="keyword">for</span> (;;) &#123;</div><div class="line">           Node h = head;</div><div class="line">           <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h != tail) &#123;</div><div class="line">               <span class="keyword">int</span> ws = h.waitStatus;</div><div class="line">               <span class="keyword">if</span> (ws == Node.SIGNAL) &#123;</div><div class="line">                   <span class="keyword">if</span> (!compareAndSetWaitStatus(h, Node.SIGNAL, <span class="number">0</span>))</div><div class="line">                       <span class="keyword">continue</span>;            <span class="comment">// loop to recheck cases</span></div><div class="line">                   unparkSuccessor(h);<span class="comment">//éå†queueï¼Œé€šçŸ¥æ‰€æœ‰SHAREDçš„èŠ‚ç‚¹ï¼Œå› ä¸ºæ˜¯å…±äº«æ¨¡å¼ï¼Œè¿™äº›Nodeéƒ½åº”è¯¥è¢«å”¤é†’ï¼Œç›´åˆ°é‡åˆ°æŸä¸ªEXCLUSIVEçš„Node</span></div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span> <span class="keyword">if</span> (ws == <span class="number">0</span> &amp;&amp;</div><div class="line">                        !compareAndSetWaitStatus(h, <span class="number">0</span>, Node.PROPAGATE))</div><div class="line">                   <span class="keyword">continue</span>;                <span class="comment">// loop on failed CAS</span></div><div class="line">           &#125;</div><div class="line">           <span class="keyword">if</span> (h == head)                   <span class="comment">// loop if head changed</span></div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>unparkSuccessorè·Ÿä¹‹å‰ç‹¬å æ¨¡å¼é‡Œé¢çš„æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œå³è°ƒç”¨unparkå”¤é†’Threadã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ä¸ºäº†é¿å…è·å–ä¸åˆ°é”é•¿æ—¶é—´ç­‰å¾…ï¼Œä¸€èˆ¬é˜»å¡çš„æ–¹æ³•éƒ½ä¼šæ”¯æŒå¸¦è¶…æ—¶æ—¶é—´çš„æ–¹æ³•ï¼Œæ¯”å¦‚CountDownLatché‡Œå°±æœ‰<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></div><div class="line">       <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">       <span class="keyword">return</span> sync.tryAcquireSharedNanos(<span class="number">1</span>, unit.toNanos(timeout));</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>è°ƒç”¨AQSé‡Œé¢çš„tryAcquireSharedNanosæ–¹æ³•<br><figure class="highlight aspectj"><table><tr><td class="code"><pre><div class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">boolean</span> <span class="title">tryAcquireSharedNanos</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">long</span> nanosTimeout)</span></span></div><div class="line">           <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">       <span class="keyword">if</span> (Thread.interrupted())</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</div><div class="line">       <span class="keyword">return</span> tryAcquireShared(arg) &gt;= <span class="number">0</span> ||</div><div class="line">           doAcquireSharedNanos(arg, nanosTimeout);</div><div class="line">   &#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">boolean</span> <span class="title">doAcquireSharedNanos</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">long</span> nanosTimeout)</span></span></div><div class="line">           <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">       <span class="keyword">if</span> (nanosTimeout &lt;= <span class="number">0</span>L)</div><div class="line">           <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">       <span class="keyword">final</span> <span class="keyword">long</span> deadline = System.nanoTime() + nanosTimeout;</div><div class="line">       <span class="keyword">final</span> Node node = addWaiter(Node.SHARED);</div><div class="line">       <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           <span class="keyword">for</span> (;;) &#123;</div><div class="line">               <span class="keyword">final</span> Node p = node.predecessor();</div><div class="line">               <span class="keyword">if</span> (p == head) &#123;</div><div class="line">                   <span class="keyword">int</span> r = tryAcquireShared(arg);</div><div class="line">                   <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</div><div class="line">                       setHeadAndPropagate(node, r);</div><div class="line">                       p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></div><div class="line">                       failed = <span class="keyword">false</span>;</div><div class="line">                       <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">               nanosTimeout = deadline - System.nanoTime();</div><div class="line">               <span class="keyword">if</span> (nanosTimeout &lt;= <span class="number">0</span>L)</div><div class="line">                   <span class="keyword">return</span> <span class="keyword">false</span>;<span class="comment">//å¦‚æœå·²ç»æ²¡æ—¶é—´äº†ï¼Œç›´æ¥return false</span></div><div class="line">               <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</div><div class="line">                   nanosTimeout &gt; spinForTimeoutThreshold)<span class="comment">//å¤§äºæŸä¸ªé˜ˆå€¼ï¼Œæ‰parkï¼Œå¦åˆ™è¿›å…¥è‡ªæ—‹</span></div><div class="line">                   LockSupport.parkNanos(<span class="keyword">this</span>, nanosTimeout);<span class="comment">//è°ƒç”¨å¸¦è¶…æ—¶çš„parkæ–¹æ³•</span></div><div class="line">               <span class="keyword">if</span> (Thread.interrupted())</div><div class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</div><div class="line">           &#125;</div><div class="line">       &#125; <span class="keyword">finally</span> &#123;</div><div class="line">           <span class="keyword">if</span> (failed)</div><div class="line">               cancelAcquire(node);</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè·Ÿä¸å¸¦è¶…æ—¶çš„doAcquireSharedInterruptiblyæ–¹æ³•ç›¸æ¯”ï¼ŒåŒºåˆ«ä¸»è¦åœ¨äºæ¯æ¬¡forå¾ªç¯æœŸé—´ï¼Œæ£€æŸ¥æ—¶é—´æ˜¯å¦è¿‡æœŸå’Œè°ƒç”¨å¸¦è¶…æ—¶çš„parkã€‚nanosTimeout &gt; spinForTimeoutThresholdè¿™ä¸ªåˆ¤æ–­ä¸»è¦æ˜¯å› ä¸ºpark/unparkæœ¬èº«ä¹Ÿéœ€è¦èŠ±æ—¶é—´ï¼Œä¸ºäº†æ›´å‡†ç¡®åœ°å®Œæˆè¶…æ—¶çš„æœºåˆ¶ï¼Œåœ¨è¶…æ—¶æ—¶é—´é©¬ä¸Šå°±è¦åˆ°äº†çš„æ—¶å€™ï¼Œå°±è¿›å…¥è‡ªæ—‹ï¼Œä¸å†parkäº†ï¼Œè¿™åº”è¯¥æ˜¯Doug Leaæµ‹è¯•äº†park/unparkæ—¶é—´æ¯”1000çº³ç§’è¦é•¿å§ã€‚<br><figure class="highlight vbnet"><table><tr><td class="code"><pre><div class="line">/**</div><div class="line">    * The number <span class="keyword">of</span> nanoseconds <span class="keyword">for</span> which it <span class="keyword">is</span> faster <span class="keyword">to</span> spin</div><div class="line">    * rather than <span class="keyword">to</span> use timed park. A rough estimate suffices</div><div class="line">    * <span class="keyword">to</span> improve responsiveness <span class="keyword">with</span> very <span class="built_in">short</span> timeouts.</div><div class="line">    */</div><div class="line">   <span class="keyword">static</span> final <span class="built_in">long</span> spinForTimeoutThreshold = <span class="number">1000</span>L;</div></pre></td></tr></table></figure></p>
<p>#æ€»ç»“</p>
<p>J.U.Cé‡ŒAQSæ˜¯ä¸€ä¸ªç›¸å½“æ ¸å¿ƒçš„ç±»ï¼Œå¯ä»¥è¯´æ²¡æœ‰å®ƒå°±æ²¡æœ‰J.U.CåŒ…ã€‚æ¨èå¤§å®¶çœ‹çœ‹<a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf" target="_blank" rel="external">AQS</a>è¿™ç¯‡è®ºæ–‡ï¼ˆç½‘ä¸Šæœ‰ä¸€äº›ç¿»è¯‘ï¼Œæ¨èå¤§å®¶è¿˜æ˜¯çœ‹åŸæ–‡å§ï¼‰ã€‚ä¸»è¦æ˜¯ç”¨ä¸€ä¸ªstateè¡¨ç¤ºçŠ¶æ€ï¼Œå­ç±»å¯ä»¥æ ¹æ®éœ€è¦æ¥å®šä¹‰stateçš„å«ä¹‰ï¼Œä»¥åŠè·å–é‡Šæ”¾èµ„æºæ—¶å…·ä½“å¦‚ä½•æ“ä½œstateï¼Œå½“ç„¶éœ€è¦é€šè¿‡CASå®ç°åŸå­æ›´æ”¹ã€‚å½“è·å–ä¸åˆ°stateçš„æ—¶å€™ï¼Œçº¿ç¨‹åŠ å…¥é˜Ÿåˆ—ï¼ŒæŒ‚èµ·ã€‚é‡Šæ”¾ä¹‹åï¼Œå”¤é†’é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ã€‚AQSæ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œç‹¬å EXCLUSIVEå’Œå…±äº«SHAREDã€‚J.U.Cé‡Œæœ¬èº«ä¹Ÿæœ‰å¾ˆå¤šç›´æ¥ç»§æ‰¿AQSå®ç°çš„ç±»ï¼ŒåŒ…æ‹¬Lockï¼ŒCountDownLatchï¼ŒSemaphoreï¼ŒFutureTaskç­‰ï¼Œå¦‚æœè¿™äº›è¿˜ä¸èƒ½æ»¡è¶³ä½ çš„ä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç»§æ‰¿AQSæ¥å®ç°éœ€è¦ã€‚</p>
<p>#Refers</p>
<ol>
<li><a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf" target="_blank" rel="external">http://gee.cs.oswego.edu/dl/papers/aqs.pdf</a></li>
<li><a href="http://ifeve.com/introduce-abstractqueuedsynchronizer/" target="_blank" rel="external">http://ifeve.com/introduce-abstractqueuedsynchronizer/</a></li>
<li><a href="http://ifeve.com/jdk1-8-abstractqueuedsynchronizer/" target="_blank" rel="external">http://ifeve.com/jdk1-8-abstractqueuedsynchronizer/</a></li>
<li><a href="http://ifeve.com/jdk1-8-abstractqueuedsynchronizer-part2/" target="_blank" rel="external">http://ifeve.com/jdk1-8-abstractqueuedsynchronizer-part2/</a></li>
<li><a href="http://book.douban.com/subject/6522893/" target="_blank" rel="external">http://book.douban.com/subject/6522893/</a></li>
<li><a href="http://my.oschina.net/magicly007/blog/364102" target="_blank" rel="external">http://my.oschina.net/magicly007/blog/364102</a></li>
</ol>
<blockquote>
<p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;java5ä¹‹åçš„java.util.concurrentåŒ…æ˜¯ä¸–ç•Œçº§å¹¶å‘å¤§å¸ˆDoug Leaçš„ä½œå“ï¼Œé‡Œé¢ä¸»è¦å®ç°äº†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;atomicåŒ…é‡ŒInteger/Longå¯¹åº”çš„åŸå­ç±»ï¼Œä¸»è¦åŸºäºCASï¼›&lt;/li&gt;
&lt;li&gt;ä¸€äº›åŒæ­¥å­ï¼ŒåŒ…æ‹¬Lockï¼ŒCountDownLatchï¼ŒSemaphoreï¼ŒFutureTaskç­‰ï¼Œè¿™äº›éƒ½æ˜¯åŸºäºAbstractQueuedSynchronizerç±»ï¼›&lt;/li&gt;
&lt;li&gt;å…³äºçº¿ç¨‹æ‰§è¡Œçš„Executorsç±»ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€äº›å¹¶å‘çš„é›†åˆç±»ï¼Œæ¯”å¦‚ConcurrentHashMapï¼ŒConcurrentLinkedQueueï¼ŒCopyOnWriteArrayListç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»AbstractQueuedSynchronizerè¿™ä¸ªå¯ä»¥è¯´æ˜¯æœ€æ ¸å¿ƒçš„ç±»ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚æ•´ä¸ªconcurrentåŒ…é‡Œï¼ŒåŸºæœ¬éƒ½ç›´æ¥æˆ–é—´æ¥åœ°ç”¨åˆ°äº†è¿™ä¸ªç±»ã€‚Doug Leaçš„è¿™ç¯‡&lt;a href=&quot;http://gee.cs.oswego.edu/dl/papers/aqs.pdf&quot;&gt;è®ºæ–‡&lt;/a&gt;é‡Œé¢è®²AQSçš„å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://magicly.me/categories/Java/"/>
    
    
      <category term="Java" scheme="http://magicly.me/tags/Java/"/>
    
      <category term="concurrency" scheme="http://magicly.me/tags/concurrency/"/>
    
      <category term="jdk" scheme="http://magicly.me/tags/jdk/"/>
    
      <category term="æºç é˜…è¯»" scheme="http://magicly.me/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    
  </entry>
  
</feed>
